var MsgingMod={sSessionId:SESSION_ID,sDepId:DEPID,sDisplayId:DISPLAYID,sPdbId:"[PDBID]",sAccessionIdString:"[ACCESSION_ID_STRING]",sAccessionIdStringEmRel:"[ACCESSION_ID_STRING_EM_REL]",sSessionPathPrefix:SESS_PATH_PREFIX,sFileSource:FILE_SOURCE,sDefaultMsgType:"vldtn",bEmbeddedView:EMBEDDED_VW,bEmEntry:EM_ENTRY,bEmMapOnly:EM_MAP_ONLY,bEmMapAndModel:EM_MAP_AND_MODEL,iAjaxTimeout:6e4,sAdminContact:'Send comments to: <a href="mailto:rsala@rcsb.rutgers.edu">help@wwpdb-dev.rutgers.edu</a>',sInfoStyle:'<span class="ui-icon ui-icon-info fltlft"></span> ',sErrStyle:'<span class="ui-icon ui-icon-alert fltlft"></span> ',bDebug:!0,oDataTable:void 0,oFilesRfrncd:{},iCnt_DrawBackCalledOnCurrentTbl:0,bResetDisplay:!0,iCrrntMsgsHwm:null,iCrrntNotesHwm:null,sCrrntRowSlctd:"",sCrrntMsgIdSlctd:"",sCrrntDataSetID:"D_000000",sCrrntContentType:"msgs",sUseServerSidePrcssing:"true",sUseThreaded:"false",sNotesFlagActive:"true",sNotesFlagActiveBmrb:"true",bAllowSorting:!1,sViewContext:"sentmsgs",bNewDraftContext:!1,iMsgCmpsHtMin:775,iMsgCmpsHtWthParentContent:875,iMsgDisplWdthMin:1200,iMsgDisplHtMin:800,iMsgDisplHtWthParentContent:850,iNoteCmpsHt:600,sCrrntCmpsMsgTmplt:"",iCmpsTotalFilesAvail:0,arrAvailFiles:[],arrMsgsAlreadyRead:[],arrMsgsForRelease:[],arrMsgsNoActionReqd:[],arrOrderedColumnList:[],arrColDisplOrderCorrHx:[],bNotesExist:!1,bTurnOffDTmDataConversion:!1,bMsgPanelShown:!1,iDTscrollTopSaved:0,iRsltsResizeContainerInitHt_Msgs:275,iBottomDTpaddingHt_Msgs:100,iScrollY_Msgs:175,iRsltsResizeContainerInitHt_CommHstry:385,iBottomDTpaddingHt_CommHstry:220,iScrollY_CommHstry:175,iRsltsResizeContainerHtPrePrint_CommHstry:385,bCorrspndncHstryStndaln:!1,sStatusCode:"",URL:{WFLAUNCH:"/service/messaging/new_session/wf",DEVLAUNCH:"/service/messaging/launch",SEE_RAW_JSON_FOR_DTBL:"/service/messaging/test_see_json",DTBL_GET_TMPLT:"/service/messaging/get_dtbl_config_dtls",DTBL_AJAX_LOAD:"/service/messaging/get_dtbl_data",DTBL_DELETE_ROW:"/service/messaging/delete_row",SUBMIT_MSG:"/service/messaging/submit_msg",ARCHIVE_MSG:"/service/messaging/archive_msg",FORWARD_MSG:"/service/messaging/forward_msg",UPDATE_DRAFT_STATE:"/service/messaging/update_draft_state",MARK_MSG_READ:"/service/messaging/mark_msg_read",TAG_MSG:"/service/messaging/tag_msg",EXIT_NOT_FINISHED:"/service/messaging/exit_not_finished",EXIT_FINISHED:"/service/messaging/exit_finished",GET_MSG:"/service/messaging/get_msg",CHECK_AVAIL_FILES:"/service/messaging/check_avail_files",GET_FILES_RFRNCD:"/service/messaging/get_files_rfrncd",CHECK_GLBL_MSG_STATUS:"/service/messaging/check_global_msg_status",DISPLAY_MSG:"/service/messaging/display_msg",TOGGLE_NOTES_FLAGGING:"/service/messaging/toggle_notes_flagging",GET_DEPUI_PWD:"/service/messaging/get_depui_pwd",GET_MSG_TMPLTS:"/service/messaging/get_msg_tmplts",VERIFY_DEPID:"/service/messaging/verify_depid"},LABEL:{MSG_THREAD_VIEW:"Switch to Message Thread View",STD_SORT_VIEW:"Switch to Standard Sorting View",TURN_OFF_NOTES_FLAG:"Disable Notes Flag in WFM UI",TURN_ON_NOTES_FLAG:"Enable Notes Flag in WFM UI",TURN_OFF_NOTES_FLAG_BMRB:"Disable BMRB Notes Flag in WFM UI",TURN_ON_NOTES_FLAG_BMRB:"Enable BMRB Notes Flag in WFM UI",SHOW_MSG_PNL:"Show Message View Panel",HIDE_MSG_PNL:"Hide Message View Panel"},STYLE:{COLOR_NOTES:"purple",COLOR_MSGS:"black",COLOR_COMMHSTRY:"blue"}};function getMsgTemplates(){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.GET_MSG_TMPLTS,clearForm:!1,dataType:"json",success:function(e){$("#msg_compose_frm").after(e.html),"status_code"in e&&(MsgingMod.sStatusCode=e.status_code),MsgingMod.bEmEntry="true"===$("#em_entry").text(),$("#msg_compose_input_em_entry").val($("#em_entry").text()),MsgingMod.bEmMapOnly="true"===$("#maponly").text(),$("#msg_compose_input_em_map_only").val($("#maponly").text()),MsgingMod.bEmMapOnly&&$("#cmps_default").parent().after('<li id="li_maponly-authstatus-em"><a href="#" class="compose" id="cmps_maponly-authstatus-em">EM Map-Only Post-Annotation</a></li>'),MsgingMod.bEmMapAndModel="true"===$("#mapandmodel").text(),$("#msg_compose_input_em_map_and_model").val($("#mapandmodel").text()),MsgingMod.sAccessionIdString=$("#accession_ids").text(),MsgingMod.sAccessionIdStringEmRel=$("#accession_ids_em_rel").text(),MsgingMod.sPdbId=$("#pdb_id").text(),MsgingMod.sDefaultMsgType=$("#default_msg_tmplt").text(),$("#new_msg_menu").removeClass("disabled").addClass("hoveractivate"),$("#new_msg_menu_link").removeClass("disabled"),$("#tmplts_loading_prompt_a").removeClass("bg-warning").addClass("bg-success").html("<strong>Message templates now loaded</strong>"),$("#tmplts_loading_prompt").fadeOut(4e3,function(){$("#tmplts_loading_prompt").addClass("hidden")}),1==MsgingMod.bEmbeddedView&&"msgs"==MsgingMod.sCrrntContentType&&1==AUTO_LAUNCH_COMPOSE&&(composeMsg(void 0,void 0,void 0,void 0,void 0,MsgingMod.sDefaultMsgType),AUTO_LAUNCH_COMPOSE=!1)}}),!1}function loadDrafts(){MsgingMod.sCrrntDataSetID=MsgingMod.sDepId,MsgingMod.sUseThreaded="false",MsgingMod.bAllowSorting=!0,MsgingMod.iCnt_DrawBackCalledOnCurrentTbl=0,loadMsgsDT("N")}function redrawTable(e){var s=!(e=void 0===e||e);$("#"+MsgingMod.sDepId+"_tbl").DataTable().draw(s)}function loadCommHstry(){MsgingMod.sUseThreaded="false",MsgingMod.bAllowSorting=!0,$("#depdatasetid").show().html("Deposition Dataset ID: "+MsgingMod.sCrrntDataSetID),MsgingMod.iCnt_DrawBackCalledOnCurrentTbl=0,MsgingMod.sCrrntContentType="commhstry",loadCommHstryDT(MsgingMod.sCrrntDataSetID)}function markRowAsSelected(e,s){var t=$(e).attr("id");$("#rslts table.DTFC_Cloned #"+t).hasClass("row_selected")||$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+t).hasClass("row_selected")?s||($("#rslts table.DTFC_Cloned #"+t).removeClass("row_selected"),$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+t).removeClass("row_selected"),MsgingMod.sCrrntRowSlctd=""):$("#rslts tbody tr.row_selected").removeClass("row_selected"),$("#rslts table.DTFC_Cloned #"+t).addClass("row_selected"),$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+t).addClass("row_selected"),MsgingMod.sCrrntRowSlctd=t;var o=MsgingMod.oDataTable.fnGetPosition(e),n=MsgingMod.oDataTable.fnGetData(o).message_id;MsgingMod.sCrrntMsgIdSlctd=n}function promptForMsgTags(e,s){"msgs"==MsgingMod.sCrrntContentType&&$(e).hasClass("row_selected")&&$(e).hasClass("msg_read")&&($("#chckbx_unread input").prop("checked",!1),$(e).hasClass("frm_annotator")?($("#chckbx_no_action_reqd input").prop("checked",!0),$("#chckbx_no_action_reqd").addClass("hidden")):($("#chckbx_no_action_reqd").removeClass("hidden"),$(e).hasClass("no_action_reqd")?$("#chckbx_no_action_reqd input").prop("checked",!0):$("#chckbx_no_action_reqd input").prop("checked",!1)),$(e).hasClass("for_release")?$("#chckbx_for_release input").prop("checked",!0):$("#chckbx_for_release input").prop("checked",!1),$("#tag_msg").modal("show"))}function closeWindow(){"Microsoft Internet Explorer"==navigator.appName?(this.focus(),self.opener=this,self.close()):(window.open("","_parent",""),window.close())}function iframeCloser(){if(window.location!=window.parent.location){var e=null;e=window.parent!=window.top?window.top:window.parent,$.isFunction(e.hideEditFrame)?(console.log("Invoking iframe close method"),e.hideEditFrame()):console.log(">>>WARNING -Can't find iframe destroy method")}}function checkGlobalMsgStatus(){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.CHECK_GLBL_MSG_STATUS,async:!0,clearForm:!1,success:function(e){if(e)if(e.all_msgs_read,e.all_msgs_actioned,"true"==e.any_notes_exist?MsgingMod.bNotesExist=!0:MsgingMod.bNotesExist=!1,void 0!==e.num_notes_records&&0<=e.num_notes_records&&(MsgingMod.iCrrntNotesHwm=e.num_notes_records),e.notes_flag_active&&e.notes_flag_active.length&&(MsgingMod.sNotesFlagActive=String(e.notes_flag_active),"true"==MsgingMod.sNotesFlagActive?$("#notes_flag_toggle").text(MsgingMod.LABEL.TURN_OFF_NOTES_FLAG):$("#notes_flag_toggle").text(MsgingMod.LABEL.TURN_ON_NOTES_FLAG)),e.notes_flag_active_bmrb&&e.notes_flag_active_bmrb.length&&($("#notes_flag_bmrb_toggle").removeClass("hidden"),MsgingMod.sNotesFlagActiveBmrb=String(e.notes_flag_active_bmrb),"true"==MsgingMod.sNotesFlagActiveBmrb?$("#notes_flag_bmrb_toggle").text(MsgingMod.LABEL.TURN_OFF_NOTES_FLAG_BMRB):$("#notes_flag_bmrb_toggle").text(MsgingMod.LABEL.TURN_ON_NOTES_FLAG_BMRB)),MsgingMod.bNotesExist){$("#get_content_type_notes").css({color:"#FF0000",borderColor:"#FF0000 rgb(82, 82, 82)",fontWeight:"bold"}),$("#get_content_type_notes").bt("There are notes present for this deposition.",{positions:["top","right"],trigger:"hoverIntent",hoverIntentOpts:{interval:850}})}else $("#get_content_type_notes").bt("There are currently no notes for this deposition.",{positions:["top","right"],trigger:"hoverIntent",hoverIntentOpts:{interval:850}})}}),!1}function toggleNotesFlagging(e){var o=e||"",n=1<o.length?"activate_notes_flagging_"+o:"activate_notes_flagging",a=1<o.length?MsgingMod.sNotesFlagActiveBmrb:MsgingMod.sNotesFlagActive;return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.TOGGLE_NOTES_FLAGGING,async:!0,clearForm:!1,beforeSubmit:function(e,s,t){e.push({name:n,value:a}),o&&e.push({name:"subtype",value:"bmrb"})},success:function(e){checkGlobalMsgStatus()}}),!1}function getFilesReferenced(){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.GET_FILES_RFRNCD,async:!0,clearForm:!1,success:function(e){e&&(MsgingMod.oFilesRfrncd=e.files_rfrncd)}}),!1}function confirmAvailFiles(s){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.CHECK_AVAIL_FILES,async:!0,clearForm:!1,success:function(e){e&&(MsgingMod.arrAvailFiles=e.file_list),"function"==typeof s&&s()}}),!1}function autoLoadMsgs(){MsgingMod.sCrrntDataSetID=MsgingMod.sDepId,MsgingMod.sUseThreaded="false",MsgingMod.bAllowSorting=!0,$("#depdatasetid").show().html("Deposition Dataset ID: "+MsgingMod.sDepId),MsgingMod.iCnt_DrawBackCalledOnCurrentTbl=0,loadMsgsDT("Y")}function Message(){this.message_subject,this.message_id,this.ordinal_id,this.message_text,this.sender,this.timestamp,this.parent_message_id,this.loadFromJson=function(e){this.message_subject=e.message_subject,this.message_id=e.message_id,this.message_text=e.message_text,this.sender=e.sender,this.timestamp=e.timestamp,this.parent_message_id=e.parent_message_id},this.loadFromDTrow=function(e){$("td",e);var s=MsgingMod.oDataTable.fnGetPosition(e);this.message_subject=MsgingMod.oDataTable.fnGetData(s).message_subject,this.sender=MsgingMod.oDataTable.fnGetData(s).sender,this.timestamp=MsgingMod.oDataTable.fnGetData(s).timestamp,this.message_text=MsgingMod.oDataTable.fnGetData(s).message_text,this.message_id=MsgingMod.oDataTable.fnGetData(s).message_id,this.ordinal_id=MsgingMod.oDataTable.fnGetData(s).ordinal_id,this.parent_message_id=MsgingMod.oDataTable.fnGetData(s).parent_message_id}}Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var s=0;s<this.length;s++)if(this[s]===e)return s;return-1}),String.prototype.startsWith=function(e){return this.match("^"+e)==e},$(document).ready(function(){function o(){$("#msg_compose").modal("hide"),progressStart(),submitNewMsg("Y")}function t(e,s){$(e).hasClass("msg_read")?("msgs"==MsgingMod.sCrrntContentType&&$("#tag_msg_choice").removeClass("ui-state-disabled"),$("#archv_msg").removeClass("ui-state-disabled")):($("#tag_msg_choice").addClass("ui-state-disabled"),$("#archv_msg").addClass("ui-state-disabled")),$("#context_menu").show(),$("#context_menu").position({my:"left-2 top-2",of:s}),$(document).on("click",function(e){$(e.target).closest("#context_menu").length||$("#context_menu").hide()})}$(document).ajaxError(function(e,s,t,o){try{0==s.status?$(".errmsg.glblerr").html(MsgingMod.sErrStyle+"You are offline!!<br />Please Check Your Network.").show().fadeOut(4e3):404==s.status?$(".errmsg.glblerr").html(MsgingMod.sErrStyle+'Requested URL "'+t.url+'" not found.<br />').show().fadeOut(4e3):500==s.status?$(".errmsg.glblerr").html(MsgingMod.sErrStyle+"Internel Server Error.<br />").show().fadeOut(4e3):"parsererror"==e?$(".errmsg.glblerr").html(MsgingMod.sErrStyle+"Error.\nParsing JSON Request failed.<br />").show().fadeOut(4e3):"timeout"==e?$(".errmsg.glblerr").html(MsgingMod.sErrStyle+"Request Time out.<br />").show().fadeOut(4e3):$(".errmsg.glblerr").html(MsgingMod.sErrStyle+s.status+" : "+o+"<br />\n").show().fadeOut(4e3)}catch(e){$(".loading").hide();var n="There was an error while processing your request.\n";n+="Error description: "+e.description+"\n",n+="Click OK to continue.\n",alert(n)}}),$("#context_menu").menu(),$("#context_menu_content").show(),$('[data-toggle="tooltip"]').tooltip(),MsgingMod.sCrrntContentType=CONTENT_TYPE,$("#forward_msg").dialog({autoOpen:!1,height:400,width:400,modal:!0,buttons:{Forward:function(){getMsgDict(MsgingMod.sCrrntMsgIdSlctd,{context:"propagate",propagate_type:"forward",callback:propagateMsg})},Cancel:function(){$("#forward_msg").dialog("close")}},close:function(){}}),"undefined"==typeof CORRSPNDNC_HSTRY_STNDALN||null===CORRSPNDNC_HSTRY_STNDALN||!1===CORRSPNDNC_HSTRY_STNDALN?(getMsgTemplates(),autoLoadMsgs(),confirmAvailFiles(),getFilesReferenced(),checkGlobalMsgStatus()):!0===CORRSPNDNC_HSTRY_STNDALN&&(MsgingMod.bCorrspndncHstryStndaln=!0,loadCommHstry()),$("#threaded_view_toggle").bt({contentSelector:"$('#threaded_view_toggle_help').html()",positions:["right","top"],trigger:"hoverIntent",width:"350px",hoverIntentOpts:{interval:850}}),$("#notes_flag_toggle").bt({contentSelector:"$('#notes_flag_toggle_help').html()",positions:["right","top"],trigger:"hoverIntent",width:"350px",hoverIntentOpts:{interval:850}}),$("#notes_flag_bmrb_toggle").bt({contentSelector:"$('#notes_flag_bmrb_toggle_help').html()",positions:["right","top"],trigger:"hoverIntent",width:"350px",hoverIntentOpts:{interval:850}}),$(".tag_msg").on("click",function(){promptForMsgTags($("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+MsgingMod.sCrrntRowSlctd)[0],"msgbody_visible")}),$("#archive_msg_ok").on("click",function(){getMsgDict(MsgingMod.sCrrntMsgIdSlctd,{context:"propagate",propagate_type:"archive",callback:propagateMsg})}),$("#tag_msg_ok").on("click",function(){var e="Y",s="Y",t="N";$("#tag_msg :checkbox:checked").each(function(){value=$(this).val(),"no_action_reqd"==value&&(e="N"),"unread"==value&&(s="N"),"for_release"==value&&(t="Y")}),tagMsg(e,s,t),"msgs"==MsgingMod.sCrrntContentType&&(MsgingMod.iDTscrollTopSaved=$("#rslts #"+MsgingMod.sDepId+"_tbl_wrapper .dataTables_scroll .dataTables_scrollBody").scrollTop(),redrawTable())}),$("#tag_msg_cancel").on("click",function(){$("#context_menu").hide()}),$("#unlock_depui").on("click",function(){"REL"==MsgingMod.sStatusCode?$("#dialog-unlock-body").html("<p style='color:red;text-align:center;'>WARNING -- WARNING -- WARNING -- WARNING -- WARNING</p><p>This entry has already been <span style='color:red;'>RELEASED</span>!!!</p><p>Click on OK to confirm that you do wish to reset and unlock the Dep UI for this entry.</p>"):$("#dialog-unlock-body").html("<p>Click on OK to confirm that you do wish to reset and unlock the Dep UI for this entry.</p>"),$("#dialog-unlock-confirm").modal("show")}),$("#tag_unlock_ok").on("click",function(){progressStart(),setTimeout(function(){$("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.GET_DEPUI_PWD,async:!0,clearForm:!1,success:function(e){if(e)try{0<e.depui_pwd.length?$.when(promise_dodepuistatus(MsgingMod.sSessionId,MsgingMod.sDepId,"unlock_with_rest")).done(function(){console.log("XXX promise depuistatus done"),progressEnd(),MsgingMod.sViewContext="sentmsgs",MsgingMod.sCrrntContentType="msgs",reLoadMsgs(),composeMsg(void 0,void 0,void 0,void 0,void 0,"system-unlocked")}).fail(function(){console.log("XXX promise depuistatus fail done"),progressEnd(),MsgingMod.sViewContext="sentmsgs",MsgingMod.sCrrntContentType="msgs",reLoadMsgs(),composeMsg(void 0,void 0,void 0,void 0,void 0,"system-unlocked")}):alert("Problem obtaining access to Dep UI")}catch(e){alert("Problem when application made request to have DEP UI reset. err="+e.message)}}}),progressEnd()},1100)}),$(".modal-wide").on("show.bs.modal",function(){var e=$(window).height()-100;$(this).find(".modal-body").css("max-height",e)}),$("#msg_compose").on("shown.bs.modal",function(e){$("#msg_compose_body").width($("#msg_compose_frm").width()-25),$("#msg_compose .modal-body").scrollTop(0)}),$(".send").on("click",function(e){var s=$("#msg_compose_subject").val();if(1<s.length)if("vldtn"==MsgingMod.sCrrntCmpsMsgTmplt||"maponly-authstatus-em"==MsgingMod.sCrrntCmpsMsgTmplt||0<=s.indexOf("Validation report")||0<=s.indexOf("are ready for your review")){var t=$("#msg_compose_assoc_files").find(".checkbox-inline input[type=checkbox]:checked").length;if(t<MsgingMod.iCmpsTotalFilesAvail)1==confirm("WARNING: Only "+t+" file(s) selected for attachment. Click 'Cancel' if you wish to abort. Click 'OK' if you wish to send.")&&o();else o()}else o();else alert("Please supply a message 'Subject'.")}),$(".reply").on("click",function(){var e="";"preview"==$(this).attr("id").split("_")[1]&&(e="preview_"),getMsgDict($("#"+e+"msg_id").val(),{context:"compose",msg_prefix:"RE: ",callback:composeMsg})}),$(".save_draft").on("click",function(){submitNewMsg("N")}),$(".archive").on("click",function(){$("#archive_msg_target_depid").val(MsgingMod.sDepId),$("#archive_msg").modal("show")}),$("#collapse_msg_preview").on("show.bs.collapse",function(){MsgingMod.bMsgPanelShown=!0;var e=$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+MsgingMod.sCrrntRowSlctd)[0];void 0===e&&(e=$("#rslts #"+MsgingMod.sDepId+"_tbl.dataTable tbody tr.dt_row:first")[0]),void 0!==e?($("#btn_collapse_msg_preview").text(MsgingMod.LABEL.HIDE_MSG_PNL),markRowAsSelected(e,!1),previewMsg(e)):$("#collapse_msg_preview").collapse("hide")}),$("#collapse_msg_preview").on("shown.bs.collapse",function(){$("#resize_container").css("height",$("#preview_msg_body").height()+70)}),$("#collapse_msg_preview").on("hide.bs.collapse",function(){$("#btn_collapse_msg_preview").text(MsgingMod.LABEL.SHOW_MSG_PNL),MsgingMod.bMsgPanelShown=!1}),$(".get_content_type").click(function(){var e=$(this).attr("id");$(".navbar li").removeClass("active");var s=$(this).attr("name");$("#hlprfrm_content_type").val(s),CONTENT_TYPE=s,MsgingMod.sCrrntContentType=CONTENT_TYPE,$("#hlprfrm_auto_launch_compose").val("false"),"commhstry"==s?loadCommHstry():"get_draft_msgs"==e||"get_draft_notes"==e?loadDrafts():(MsgingMod.sViewContext="sentmsgs",reLoadMsgs())}),$(".test_getmsgs_see_json").click(function(){var e=$(this).attr("name");loadTestExampleSeeJson(MsgingMod.sCrrntDataSetID=e)}),$("#threaded_view_toggle").click(function(){var e=$(this).text(),s=(MsgingMod.sDepId,e==MsgingMod.LABEL.MSG_THREAD_VIEW?MsgingMod.LABEL.STD_SORT_VIEW:MsgingMod.LABEL.MSG_THREAD_VIEW);$(this).text(s),MsgingMod.sUseThreaded=e==MsgingMod.LABEL.MSG_THREAD_VIEW?"true":"false",MsgingMod.bAllowSorting=e!=MsgingMod.LABEL.MSG_THREAD_VIEW,MsgingMod.iCnt_DrawBackCalledOnCurrentTbl=0,loadMsgsDT("Y")}),$("#notes_flag_toggle").click(function(){var e=$(this).text(),s=(MsgingMod.sCrrntDataSetID,e==MsgingMod.LABEL.TURN_OFF_NOTES_FLAG?MsgingMod.LABEL.TURN_ON_NOTES_FLAG:MsgingMod.LABEL.TURN_OFF_NOTES_FLAG);$(this).text(s),MsgingMod.sNotesFlagActive=e==MsgingMod.LABEL.TURN_OFF_NOTES_FLAG?"false":"true",toggleNotesFlagging()}),$("#notes_flag_bmrb_toggle").click(function(){var e=$(this).text(),s=(MsgingMod.sCrrntDataSetID,e==MsgingMod.LABEL.TURN_OFF_NOTES_FLAG_BMRB?MsgingMod.LABEL.TURN_ON_NOTES_FLAG_BMRB:MsgingMod.LABEL.TURN_OFF_NOTES_FLAG_BMRB);$(this).text(s),MsgingMod.sNotesFlagActiveBmrb=e==MsgingMod.LABEL.TURN_OFF_NOTES_FLAG_BMRB?"false":"true",toggleNotesFlagging("bmrb")}),$("#msging-navbar").on("click",".compose",function(){"drafts"==MsgingMod.sViewContext?MsgingMod.bNewDraftContext=!0:MsgingMod.bNewDraftContext=!1,composeMsg(void 0,void 0,void 0,void 0,void 0,$(this).attr("id").split("_")[1])}),$(".edit").click(function(){displayDraftMsg($("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+MsgingMod.sCrrntRowSlctd)[0])}),$("#rslts").on("click","tbody tr",function(e){var s=this;if(e.ctrlKey||e.metaKey)return"commhstry"!=MsgingMod.sCrrntContentType&&"drafts"!=MsgingMod.sViewContext&&(markRowAsSelected(s,!0),t(s,e)),!1;markRowAsSelected(s,!1),MsgingMod.bMsgPanelShown&&previewMsg(s)}),$("#rslts").on("contextmenu","tbody tr",function(e){if("commhstry"!=MsgingMod.sCrrntContentType&&"drafts"!=MsgingMod.sViewContext){markRowAsSelected(this,!0),t(this,e)}return!1}),$(".msg_context_menu_choice").click(function(){var e=$(this).attr("id"),s=$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+MsgingMod.sCrrntRowSlctd)[0];if("tag_msg_choice"==e)$(s).hasClass("msg_read")&&promptForMsgTags(s,"msgbody_hidden");else if("archv_msg"==e)$(s).hasClass("msg_read")&&($("#archive_msg_target_depid").val(MsgingMod.sDepId),$("#archive_msg").modal("show"));else if("fwd_msg"==e)$("#forward_msg_target_depid").val(""),$("#forward_msg").dialog("open");else if("view_msg_nw_wndw"==e){displayMsg(s,!0);var t=$(s).attr("id");$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+t).addClass("msg_read")}$("#context_menu").hide()}),$("#rslts").on("dblclick","tbody tr",function(e){var s=$(this).attr("id");$("#rslts table.DTFC_Cloned #"+s).hasClass("row_selected")||$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+s).hasClass("row_selected")||($("#rslts tbody tr.row_selected").removeClass("row_selected"),$("#rslts table.DTFC_Cloned #"+s).addClass("row_selected"),$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+s).addClass("row_selected"),$("#"+MsgingMod.sCrrntDataSetID+"_delete_row").show(),$(".help.unselect").show(),$(".help.select_to_delete").hide(),MsgingMod.sCrrntRowSlctd=s),MsgingMod.bCorrspndncHstryStndaln||($("#rslts table.DTFC_Cloned #"+s).addClass("msg_read"),$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+s).addClass("msg_read")),"drafts"!=MsgingMod.sViewContext?displayMsg(this,!1):displayDraftMsg(this)}),$(".clearfile").on("click",function(e){clearFileUpload($(this).attr("id").split("clear")[1])}),$(".addanother").on("click",function(e){var s=$(this).attr("id").split("addanother")[1];$("#aux-file-span"+(parseInt(s)+1)).removeClass("hidden")}),$("#other-value-form").find("input").keypress(function(e){if(e.which&&13==e.which||e.keyCode&&13==e.keyCode)return $(this).parent().parent().parent().parent().find(".ui-dialog-buttonpane").find("button:first").click(),!1}),$("#select_all_file_references").on("click",function(){$("#msg_compose_assoc_files").find("input[type=checkbox]:visible").prop("checked",this.checked)}),$(".assoc_files_chckbox input[type=checkbox]").on("click",function(){this.checked||$("#select_all_file_references").prop("checked",this.checked)}),$("#msglist_panel").on("click",".DTTT_button_print",function(){$("#rslts_resize_container").height($("#"+MsgingMod.sDepId+"_tbl").height()+10)}),$("#testcheckboxes").click(function(){var e="",s=0;$("#rslts :checkbox:checked").each(function(){s++,e+=(0<e.length?",":"")+$(this).parents("td").attr("true_row_idx")}),$("#rowids").val(e),0<s?alert("List of row IDs currently selected for cif category '"+MsgingMod.sCrrntDataSetID+"' is: "+e):alert("Currently no row(s) selected for cif category '"+MsgingMod.sCrrntDataSetID+"'")})});var calcDataTableHeight=function(){var e="commhstry"==MsgingMod.sCrrntContentType?MsgingMod.iBottomDTpaddingHt_CommHstry:MsgingMod.iBottomDTpaddingHt_Msgs;return Math.floor($("#rslts_resize_container").height())-e+"px"};function reLoadMsgs(){loadMsgsDT("sentmsgs"==MsgingMod.sViewContext?"Y":"N")}function loadMsgsDT(sendStatusToUse){var sContentType;return"Y"==sendStatusToUse?(MsgingMod.sViewContext="sentmsgs",$("#tag_msg_choice").removeClass("ui-state-disabled")):(MsgingMod.sViewContext="drafts",$("#tag_msg_choice").addClass("ui-state-disabled")),"notes"==MsgingMod.sCrrntContentType?(sContentType=MsgingMod.sCrrntContentType,$("#tag_msg_choice").addClass("ui-state-disabled")):"msgs"==MsgingMod.sCrrntContentType&&(sContentType="messages"),$("#hlprfrm_content_type").val(MsgingMod.sCrrntContentType),$("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.DTBL_GET_TMPLT,async:!0,clearForm:!1,dataType:"json",beforeSubmit:function(e,s,t){e.push({name:"serverside",value:MsgingMod.sUseServerSidePrcssing}),e.push({name:"usethreaded",value:MsgingMod.sUseThreaded}),e.push({name:"send_status",value:sendStatusToUse})},success:function(jsonData){if(MsgingMod.sCrrntDataSetID=MsgingMod.sDepId,$("#rslts").html(jsonData.html),jsonData.dtbl_config_dict){void 0!==jsonData.dtbl_config_dict.CURRENT_NUM_MSGS_TO_DPSTR&&null!=jsonData.dtbl_config_dict.CURRENT_NUM_MSGS_TO_DPSTR&&(MsgingMod.iCrrntMsgsHwm=jsonData.dtbl_config_dict.CURRENT_NUM_MSGS_TO_DPSTR),void 0!==jsonData.dtbl_config_dict.CURRENT_NUM_NOTES&&null!=jsonData.dtbl_config_dict.CURRENT_NUM_NOTES&&(MsgingMod.iCrrntNotesHwm=jsonData.dtbl_config_dict.CURRENT_NUM_NOTES),void 0!==jsonData.dtbl_config_dict.MSGS_ALREADY_READ&&null!=jsonData.dtbl_config_dict.MSGS_ALREADY_READ&&(MsgingMod.arrMsgsAlreadyRead=jsonData.dtbl_config_dict.MSGS_ALREADY_READ),void 0!==jsonData.dtbl_config_dict.MSGS_FOR_RELEASE&&null!=jsonData.dtbl_config_dict.MSGS_FOR_RELEASE&&(MsgingMod.arrMsgsForRelease=jsonData.dtbl_config_dict.MSGS_FOR_RELEASE),void 0!==jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD&&null!=jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD&&(MsgingMod.arrMsgsNoActionReqd=jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD),void 0!==jsonData.dtbl_config_dict.ORDERED_COLUMN_LIST&&null!=jsonData.dtbl_config_dict.ORDERED_COLUMN_LIST&&(MsgingMod.arrOrderedColumnList=jsonData.dtbl_config_dict.ORDERED_COLUMN_LIST);var oTable=$("#"+MsgingMod.sDepId+"_tbl").dataTable({sDom:'R<"depdatasetlabel fltlft"><"fltrgt"f>tlip',oLanguage:{sSearch:"Search "+sContentType+":",sEmptyTable:"No messages to display"},bProcessing:!1,bServerSide:eval(MsgingMod.sUseServerSidePrcssing),sAjaxSource:MsgingMod.URL.DTBL_AJAX_LOAD,fnServerParams:function(e){e.push({name:"identifier",value:MsgingMod.sDepId}),e.push({name:"sessionid",value:MsgingMod.sSessionId}),e.push({name:"filesource",value:MsgingMod.sFileSource}),e.push({name:"serverside",value:MsgingMod.sUseServerSidePrcssing}),e.push({name:"usethreaded",value:MsgingMod.sUseThreaded}),e.push({name:"send_status",value:sendStatusToUse}),e.push({name:"content_type",value:MsgingMod.sCrrntContentType})},bScrollCollapse:!0,bPaginate:!1,sScrollY:MsgingMod.iScrollY_Msgs+"px",bFilter:!0,bSortCellsTop:MsgingMod.bAllowSorting,bSort:MsgingMod.bAllowSorting,bInfo:!0,bAutoWidth:!0,fnInitComplete:function(e,s){$("#rslts_resize_container").height($("#rslts #"+MsgingMod.sDepId+"_tbl_wrapper .dataTables_scroll .dataTables_scrollBody").height()+110);var t="notes"==MsgingMod.sCrrntContentType?"Annotator Processing Notes":"Communications with Depositor";$(".depdatasetlabel").html("<h4>"+MsgingMod.sDisplayId+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+t+"</h4>"),"notes"==MsgingMod.sCrrntContentType?$("h2, h3, h4").css("color",MsgingMod.STYLE.COLOR_NOTES):$("h2, h3, h4").css("color",MsgingMod.STYLE.COLOR_MSGS),$("tr.srch_hdrs").hide();var o=$("#rslts #"+MsgingMod.sDepId+"_tbl.dataTable tbody tr#row_0.dt_row")[0];void 0!==o?(markRowAsSelected(o,!1),1==MsgingMod.bMsgPanelShown&&previewMsg(o)):(MsgingMod.sCrrntRowSlctd="",1==MsgingMod.bMsgPanelShown&&$("#collapse_msg_preview").collapse("hide"))},fnDrawCallback:function(){if(MsgingMod.iCnt_DrawBackCalledOnCurrentTbl+=1,0<MsgingMod.iDTscrollTopSaved&&$("#rslts #"+MsgingMod.sDepId+"_tbl_wrapper .dataTables_scroll .dataTables_scrollBody").scrollTop(MsgingMod.iDTscrollTopSaved),0<MsgingMod.sCrrntRowSlctd.length){var e=$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+MsgingMod.sCrrntRowSlctd)[0];if(void 0!==e){markRowAsSelected(e,!1);for(var s=MsgingMod.oDataTable.fnGetPosition(e),t=MsgingMod.oDataTable.fnGetData(s).message_id,o=!1,n=!1,a=!1,i=0;i<MsgingMod.arrMsgsAlreadyRead.length;i++)if(t==MsgingMod.arrMsgsAlreadyRead[i]){$(e).addClass("msg_read"),o=!0;break}if(o||$(e).removeClass("msg_read"),"msgs"==MsgingMod.sCrrntContentType){for(i=0;i<MsgingMod.arrMsgsNoActionReqd.length;i++)if(t==MsgingMod.arrMsgsNoActionReqd[i]){$(e).addClass("no_action_reqd"),$(e).removeClass("action_reqd"),$(e).find("td:first").css("background","none"),a=!0;break}a||($(e).removeClass("no_action_reqd"),$(e).addClass("action_reqd"),$(e).find("td:first").css("background","url('/msgmodule/images/stock_todo.png') no-repeat center left"));for(i=0;i<MsgingMod.arrMsgsForRelease.length;i++)if(t==MsgingMod.arrMsgsForRelease[i]){$(e).addClass("for_release"),$(e).find("td:first").css("background","url('/msgmodule/images/release.png') no-repeat center left"),n=!0;break}n||($(e).removeClass("for_release"),a&&$(e).find("td:first").css("background","none"))}}}$("#rslts_resize_container").resizable({handles:"s",minHeight:MsgingMod.iScrollY_Msgs}),$("#rslts_resize_container").resize(function(){MsgingMod.oDataTable.fnSettings().oScroll.sY=calcDataTableHeight()})},aoColumns:jsonData.dtbl_config_dict.DTBL_AOCOLUMNS,aaSorting:[[convertColNameToIntIndex("timestamp"),"desc"]],aoColumnDefs:[{aTargets:[convertColNameToIntIndex("ordinal_id"),convertColNameToIntIndex("message_id"),convertColNameToIntIndex("deposition_data_set_id"),convertColNameToIntIndex("context_type"),convertColNameToIntIndex("context_value"),convertColNameToIntIndex("parent_message_id"),convertColNameToIntIndex("message_text"),convertColNameToIntIndex("message_type"),convertColNameToIntIndex("send_status")],bVisible:!1},{aTargets:[convertColNameToIntIndex("message_subject")],sWidth:"62%",fnCreatedCell:function(e,s,t,o,n){var a=$(e),i=!0;jsonData.dtbl_config_dict.INDENT_DICT?a.addClass("indent_"+jsonData.dtbl_config_dict.INDENT_DICT[t.message_id]):"msgs"==MsgingMod.sCrrntContentType&&"sentmsgs"==MsgingMod.sViewContext&&a.addClass("indent_0");for(var r=0;r<jsonData.dtbl_config_dict.MSGS_ALREADY_READ.length;r++)t.message_id==jsonData.dtbl_config_dict.MSGS_ALREADY_READ[r]&&a.parent().addClass("msg_read");if("msgs"==MsgingMod.sCrrntContentType){a.parent().addClass("action_reqd"),a.css("background","url('/msgmodule/images/stock_todo.png') no-repeat center left");for(r=0;r<jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD.length;r++)if(t.message_id==jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD[r]){a.parent().addClass("no_action_reqd"),a.parent().removeClass("action_reqd"),i=!1,a.css("background","none");break}for(r=0;r<MsgingMod.arrMsgsNoActionReqd.length;r++)if(t.message_id==MsgingMod.arrMsgsNoActionReqd[r]){a.parent().addClass("no_action_reqd"),a.parent().removeClass("action_reqd"),i=!1,a.css("background","none");break}}a.parent().removeClass("for_release"),i||a.css("background","none");for(r=0;r<jsonData.dtbl_config_dict.MSGS_FOR_RELEASE.length;r++)if(t.message_id==jsonData.dtbl_config_dict.MSGS_FOR_RELEASE[r]){a.parent().addClass("for_release"),a.css("background","url('/msgmodule/images/release.png') no-repeat center left");break}}},{aTargets:[convertColNameToIntIndex("sender")],sWidth:"28%",fnCreatedCell:function(e,s,t,o,n){var a=$(e);s.startsWith("depositor")||a.parent().addClass("frm_annotator")}},{aTargets:[convertColNameToIntIndex("timestamp")],sWidth:"10%"}],oColReorder:{aiOrder:[convertColNameToIntIndex("message_subject"),convertColNameToIntIndex("sender"),convertColNameToIntIndex("timestamp"),convertColNameToIntIndex("ordinal_id"),convertColNameToIntIndex("message_id"),convertColNameToIntIndex("deposition_data_set_id"),convertColNameToIntIndex("context_type"),convertColNameToIntIndex("context_value"),convertColNameToIntIndex("parent_message_id"),convertColNameToIntIndex("message_text"),convertColNameToIntIndex("message_type"),convertColNameToIntIndex("send_status")]}});MsgingMod.oDataTable=oTable}"notes"==MsgingMod.sCrrntContentType?($(".notes_view_only").show(),$("#get_content_type_notes").parent().addClass("active"),$(".msg_view_only").hide()):($(".msg_view_only").show(),$(".notes_view_only").hide(),"sentmsgs"==MsgingMod.sViewContext?($("#threaded_view_toggle").show(),$("#get_content_type_msgs").parent().addClass("active")):($("#threaded_view_toggle").hide(),$("#get_draft_msgs").parent().addClass("active"))),$("#archive_display").show()}}),!1}function loadCommHstryDT(){return MsgingMod.sViewContext="sentmsgs",$("#hlprfrm_content_type").val(MsgingMod.sCrrntContentType),$("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.DTBL_GET_TMPLT,async:!0,clearForm:!1,dataType:"json",beforeSubmit:function(e,s,t){e.push({name:"serverside",value:MsgingMod.sUseServerSidePrcssing}),e.push({name:"usethreaded",value:MsgingMod.sUseThreaded}),e.push({name:"send_status",value:"Y"})},success:function(jsonData){if(MsgingMod.sCrrntDataSetID=MsgingMod.sDepId,$("#rslts").html(jsonData.html),jsonData.dtbl_config_dict){void 0!==jsonData.dtbl_config_dict.MSGS_ALREADY_READ&&null!=jsonData.dtbl_config_dict.MSGS_ALREADY_READ&&(MsgingMod.arrMsgsAlreadyRead=jsonData.dtbl_config_dict.MSGS_ALREADY_READ),void 0!==jsonData.dtbl_config_dict.ORDERED_COLUMN_LIST&&null!=jsonData.dtbl_config_dict.ORDERED_COLUMN_LIST&&(MsgingMod.arrOrderedColumnList=jsonData.dtbl_config_dict.ORDERED_COLUMN_LIST,MsgingMod.arrColDisplOrderCorrHx=[convertColNameToIntIndex("message_subject"),convertColNameToIntIndex("sender"),convertColNameToIntIndex("timestamp"),convertColNameToIntIndex("orig_sender"),convertColNameToIntIndex("orig_timestamp"),convertColNameToIntIndex("orig_recipient"),convertColNameToIntIndex("orig_message_subject"),convertColNameToIntIndex("orig_attachments"),convertColNameToIntIndex("ordinal_id"),convertColNameToIntIndex("message_id"),convertColNameToIntIndex("deposition_data_set_id"),convertColNameToIntIndex("context_type"),convertColNameToIntIndex("context_value"),convertColNameToIntIndex("parent_message_id"),convertColNameToIntIndex("message_text"),convertColNameToIntIndex("message_type"),convertColNameToIntIndex("send_status"),convertColNameToIntIndex("orig_message_id"),convertColNameToIntIndex("orig_deposition_data_set_id")]);var mColumns=[0,1,2,3,4,5,6,7,10],oTable=$("#"+MsgingMod.sDepId+"_tbl").dataTable({sDom:'R<"depdatasetlabel fltlft"><"fltrgt"f>tlip<"clearfloat">T',tableTools:{sSwfPath:"/msgmodule/swf/copy_csv_xls_pdf.swf",aButtons:[{sExtends:"xls",sButtonText:"Excel (tab delim file)",mColumns:mColumns},{sExtends:"copy",mColumns:mColumns},"print"]},oLanguage:{sSearch:"Search Comm History:",sEmptyTable:"No messages to display"},bSortCellsTop:!0,bProcessing:!1,bServerSide:eval(MsgingMod.sUseServerSidePrcssing),sAjaxSource:MsgingMod.URL.DTBL_AJAX_LOAD,fnServerParams:function(e){e.push({name:"identifier",value:MsgingMod.sDepId}),e.push({name:"sessionid",value:MsgingMod.sSessionId}),e.push({name:"filesource",value:MsgingMod.sFileSource}),e.push({name:"serverside",value:MsgingMod.sUseServerSidePrcssing}),e.push({name:"usethreaded",value:MsgingMod.sUseThreaded}),e.push({name:"send_status",value:"Y"}),e.push({name:"content_type",value:MsgingMod.sCrrntContentType})},bScrollCollapse:!0,bPaginate:!1,sScrollY:MsgingMod.iScrollY_CommHstry+"px",bFilter:!0,bSort:eval(MsgingMod.bAllowSorting),bInfo:!0,bAutoWidth:!1,fnInitComplete:function(e,s){$("#rslts_resize_container").height($("#rslts #"+MsgingMod.sDepId+"_tbl_wrapper .dataTables_scroll .dataTables_scrollBody").height()+220),$(window).resize(function(){MsgingMod.oDataTable.fnAdjustColumnSizing()}),$(".depdatasetlabel").html("<h4>"+MsgingMod.sDepId+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Complete Correspondence History</h4>"),"commhstry"==MsgingMod.sCrrntContentType?$("h2, h3, h4").css("color",MsgingMod.STYLE.COLOR_COMMHSTRY):$("h2, h3, h4").css("color",MsgingMod.STYLE.COLOR_MSGS),$("tr.srch_hdrs").show(),oTable.fnDraw(),oTable.fnAdjustColumnSizing();var t=$("#rslts #"+MsgingMod.sDepId+"_tbl.dataTable tbody tr#row_0.dt_row")[0];void 0!==t?(markRowAsSelected(t,!1),1==MsgingMod.bMsgPanelShown&&previewMsg(t)):1==MsgingMod.bMsgPanelShown&&$("#collapse_msg_preview").collapse("hide")},aoColumns:jsonData.dtbl_config_dict.DTBL_AOCOLUMNS,aaSorting:[[convertColNameToIntIndex("timestamp"),"desc"]],aoColumnDefs:[{aTargets:[convertColNameToIntIndex("ordinal_id"),convertColNameToIntIndex("message_id"),convertColNameToIntIndex("deposition_data_set_id"),convertColNameToIntIndex("context_type"),convertColNameToIntIndex("context_value"),convertColNameToIntIndex("parent_message_id"),convertColNameToIntIndex("message_text"),convertColNameToIntIndex("message_type"),convertColNameToIntIndex("send_status"),convertColNameToIntIndex("orig_message_id"),convertColNameToIntIndex("orig_deposition_data_set_id")],bVisible:!1},{aTargets:[convertColNameToIntIndex("message_subject")],sWidth:"25%",fnCreatedCell:function(e,s,t,o,n){var a=$(e),i=!0;a.addClass("indent_0");for(var r=0;r<jsonData.dtbl_config_dict.MSGS_ALREADY_READ.length;r++)t.message_id==jsonData.dtbl_config_dict.MSGS_ALREADY_READ[r]&&a.parent().addClass("msg_read");for(r=0;r<MsgingMod.arrMsgsAlreadyRead.length;r++)t.message_id==MsgingMod.arrMsgsAlreadyRead[r]&&a.parent().addClass("msg_read");a.parent().addClass("action_reqd"),a.css("background","url('/msgmodule/images/stock_todo.png') no-repeat center left");for(r=0;r<jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD.length;r++)if(t.message_id==jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD[r]){a.parent().addClass("no_action_reqd"),a.parent().removeClass("action_reqd"),i=!1,a.css("background","none");break}for(r=0;r<jsonData.dtbl_config_dict.NOTES_MSG_IDS.length;r++)if(t.message_id==jsonData.dtbl_config_dict.NOTES_MSG_IDS[r]){a.parent().addClass("no_action_reqd"),a.parent().removeClass("action_reqd"),i=!1,a.css("background","none");break}a.parent().removeClass("for_release"),i||a.css("background","none");for(r=0;r<jsonData.dtbl_config_dict.MSGS_FOR_RELEASE.length;r++)if(t.message_id==jsonData.dtbl_config_dict.MSGS_FOR_RELEASE[r]){a.parent().addClass("for_release"),a.css("background","url('/msgmodule/images/release.png') no-repeat center left");break}}},{aTargets:[convertColNameToIntIndex("sender")],sWidth:"8%"},{aTargets:[convertColNameToIntIndex("timestamp")],sWidth:"10%"},{aTargets:[convertColNameToIntIndex("orig_sender")],sWidth:"8%"},{aTargets:[convertColNameToIntIndex("orig_timestamp")],sWidth:"10%"},{aTargets:[convertColNameToIntIndex("orig_recipient")],sWidth:"8%"},{aTargets:[convertColNameToIntIndex("orig_message_subject")],sWidth:"25%"},{aTargets:[convertColNameToIntIndex("orig_attachments")],sWidth:"5%"}],fnDrawCallback:function(){if(MsgingMod.iCnt_DrawBackCalledOnCurrentTbl+=1,applySearchHeaderFunctions(oTable),0<MsgingMod.iDTscrollTopSaved&&$("#rslts #"+MsgingMod.sDepId+"_tbl_wrapper .dataTables_scroll .dataTables_scrollBody").scrollTop(MsgingMod.iDTscrollTopSaved),0<MsgingMod.sCrrntRowSlctd.length){var e=$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+MsgingMod.sCrrntRowSlctd)[0];if(void 0!==e){markRowAsSelected(e,!1);for(var s=MsgingMod.oDataTable.fnGetPosition(e),t=MsgingMod.oDataTable.fnGetData(s).message_id,o=!1,n=0;n<MsgingMod.arrMsgsAlreadyRead.length;n++)if(t==MsgingMod.arrMsgsAlreadyRead[n]){$(e).addClass("msg_read"),o=!0;break}o||$(e).removeClass("msg_read")}}$("#rslts_resize_container").resizable({handles:"s",minHeight:MsgingMod.iScrollY_CommHstry+125}),$("#rslts_resize_container").resize(function(){MsgingMod.oDataTable.fnSettings().oScroll.sY=calcDataTableHeight(),MsgingMod.oDataTable.fnAdjustColumnSizing()})},oColReorder:{aiOrder:MsgingMod.arrColDisplOrderCorrHx}});MsgingMod.oDataTable=oTable}$("#get_content_type_commhstry").parent().addClass("active"),$(".notes_view_only").hide(),$(".msg_view_only").hide(),$("#archive_display").hide()}}),!1}function clearFileUpload(e){if("all"==e)for(var s=1;s<4;s++)$("#aux-file"+s).replaceWith('<input type="file" size="50" id="aux-file'+s+'" name="aux-file'+s+'" class="c_'+MsgingMod.sDepId+' file_upload fltlft"/>');else $("#aux-file"+e).replaceWith('<input type="file" size="50" id="aux-file'+e+'" name="aux-file'+e+'" class="c_'+MsgingMod.sDepId+' file_upload fltlft"/>')}function resetTextArea(e){$("#msg_compose_body").replaceWith($("#msg_compose_body_tmplt_"+e).clone().attr("id","msg_compose_body").removeClass("displaynone"))}function composeMsg(e,s,t,o,n,a){"notes"==MsgingMod.sCrrntContentType?$("#msg_compose_body").val(""):void 0!==a?resetTextArea(a):$("#msg_compose_body").val(""),MsgingMod.sCrrntCmpsMsgTmplt=a,s&&void 0!==s?$("#msg_compose_parent_msg_id").val(s):$("#msg_compose_parent_msg_id").val(""),$("#msg_compose_subject").val("");var i=MsgingMod.bEmMapOnly?"Entry":"Structure",r=MsgingMod.bEmMapOnly?"Processed files":"Validation report and processed files",d=MsgingMod.bEmEntry?MsgingMod.sAccessionIdStringEmRel:MsgingMod.sAccessionIdString;e&&void 0!==e?$("#msg_compose_subject").val(e):void 0!==a&&"vldtn"==a?$("#msg_compose_subject").val(MsgingMod.sAccessionIdString+" - "+r+" are ready for your review"):void 0!==a&&"approval-expl"==a?$("#msg_compose_subject").val("Acknowledgement of "+i+" Approval"):void 0!==a&&"approval-impl"==a?$("#msg_compose_subject").val("Implicit Approval of Your "+i):void 0!==a&&-1<["release-publ","release-nopubl"].indexOf(a)?$("#msg_compose_subject").val("Release of "+d):void 0!==a&&"reminder"==a?$("#msg_compose_subject").val("Still awaiting feedback for "+MsgingMod.sAccessionIdString):void 0!==a&&"system-unlocked"==a?$("#msg_compose_subject").val("System Unlocked"):void 0!==a&&"withdrawn"==a?$("#msg_compose_subject").val("PDB ID "+MsgingMod.sPdbId+" has been withdrawn"):void 0!==a&&"maponly-authstatus-em"==a?$("#msg_compose_subject").val("Annotation of your "+MsgingMod.sAccessionIdString):"notes"!=MsgingMod.sCrrntContentType&&$("#msg_compose_subject").val("Communication regarding "+MsgingMod.sAccessionIdString),t&&void 0!==t?($("#msg_compose_parent_msg_div").removeClass("hidden"),$("#msg_compose_parent_msg").html('<p><span class="strong">SENDER:</span> '+o+'</p><p><span class="strong">DATE/TIME:</span> '+n+"</p><p>"+t+"</p>")):($("#msg_compose_parent_msg").html(""),$("#msg_compose_parent_msg_div").addClass("hidden")),"notes"==MsgingMod.sCrrntContentType?($("#msg_compose_assoc_files").addClass("hidden"),$("#msg_compose_attch_aux_file").addClass("hidden")):($("#msg_compose_assoc_files").removeClass("hidden"),$("#msg_compose_attch_aux_file").removeClass("hidden")),$("#msg_compose_subject").focus(),$("#msg_compose_body").scrollTop(0),clearFileUpload("all"),$("#aux-file-span2").addClass("hidden"),$("#aux-file-span3").addClass("hidden"),$("#msg_compose").on("shown.bs.modal",function(e){void 0!==a&&-1<["vldtn","release-publ","release-nopubl","maponly-authstatus-em"].indexOf(a)?$("#msg_compose_assoc_files").find("input[type=checkbox]:visible").prop("checked",!0):void 0!==a&&-1<["withdrawn"].indexOf(a)?$("#checkbox_model").find("input[type=checkbox]:visible").prop("checked",!0):$("#msg_compose_assoc_files input:checkbox").prop("checked",!1),MsgingMod.iCmpsTotalFilesAvail=$("#msg_compose_assoc_files").find(".checkbox-inline input[type=checkbox]:visible").length}),"msgs"==MsgingMod.sCrrntContentType?confirmAvailFiles(function(){for(var e=[["val-report","PDF report"],["val-report-full","full PDF report"],["val-data","XML data"],["val-report-slider","slider"],["val-report-wwpdb-fo-fc-edmap-coef","fofc map coef"],["val-report-wwpdb-2fo-fc-edmap-coef","2fofc map coef"]],s=[],t=0;t<e.length;t++){key=e[t][0],val=e[t][1];for(var o=0;o<MsgingMod.arrAvailFiles.length;o++)MsgingMod.arrAvailFiles[o]===key&&s.push(val)}var n=s.join(", ");0<n.length&&$("#checkbox_val-report-batch-opttext").html(" ("+n+")");for(t=0;t<MsgingMod.arrAvailFiles.length;t++)MsgingMod.bEmEntry&&MsgingMod.bEmMapOnly&&("model"===MsgingMod.arrAvailFiles[t]||"model_pdb"===MsgingMod.arrAvailFiles[t])||$("#checkbox_"+MsgingMod.arrAvailFiles[t]).removeClass("hidden");$("#msg_compose").modal("show")}):$("#msg_compose").modal("show")}function displayDraftMsg(e){MsgingMod.bNewDraftContext=!1;var s=new Message;s.loadFromDTrow(e);var t=s.message_text.replace(/<br \/>/g,"\n");if($("#msg_compose_msg_id").val(s.message_id),s.parent_message_id!=s.message_id){var o={context:"compose",msg_subject:s.message_subject,msg_text:t,callback:composeMsg};getMsgDict(s.parent_message_id,o)}else composeMsg(s.message_subject,void 0,void 0,void 0,void 0,void 0);markMsgAsRead(s.message_id),$("#msg_compose_body").val(t)}function getFileReferences(e){var s=[],t=[];for(var o in MsgingMod.oFilesRfrncd)if(o==e){s=MsgingMod.oFilesRfrncd[o];break}if(0<s.length)for(var n=0;n<s.length;n++){var a=s[n],i=a.relative_file_url.split("/"),r=i[i.length-1];a.file_name=r,t.push(a)}return t}function previewMsg(e){var s=new Message;if(s.loadFromDTrow(e),s.parent_message_id!=s.message_id){getMsgDict(s.parent_message_id,{context:"display",display_type:"preview_pane"})}else $("#preview_parent_msg").html(""),$("#preview_parent_msg_div").hide();"drafts"==MsgingMod.sViewContext?($(".preview_msg_action_btn").hide(),$(".draft_view").show()):"commhstry"!=MsgingMod.sCrrntContentType?("notes"==MsgingMod.sCrrntContentType?$(".preview_msg_action_btn.archive").show():$(".preview_msg_action_btn").show(),$(".draft_view").hide()):$(".preview_msg_action_btn").hide();var t=getFileReferences(s.message_id);if(0<t.length){$("#files_rfrncd_div").show();for(var o="",n=0;n<t.length;n++){var a=t[n],i=1<a.upload_file_name.length?" ("+a.upload_file_name+")":"";o+='<p><span class=""><a href="'+a.relative_file_url+'" target="_blank">'+a.file_name+i+"</a></span></p>"}$("#files_rfrncd").html(o)}else $("#files_rfrncd").html(""),$("#files_rfrncd_div").hide();$("#preview_msg_dep_id").html(MsgingMod.sCrrntDataSetID),$("#preview_msg_id").val(s.message_id),$("#preview_msg_ordinal_id").html(s.ordinal_id),$("#preview_msg_subject").html(s.message_subject),$("#preview_msg_sender").html(s.sender),$("#preview_msg_timestamp").html(s.timestamp),$("#preview_msg_body").html(s.message_text),$("#preview_msg").css({overflow:"auto",height:"99%"}),$("#resize_container").resizable({handles:"s",minHeight:150}),$("#preview_msg").scrollTop(0),MsgingMod.iDTscrollTopSaved=$("#rslts #"+MsgingMod.sDepId+"_tbl_wrapper .dataTables_scroll .dataTables_scrollBody").scrollTop(),MsgingMod.bCorrspndncHstryStndaln||(markMsgAsRead(s.message_id),redrawTable()),$("#resize_container").css("height",$("#preview_msg_body").height()+70)}function displayMsg(e,s){var t=new Message;if(t.loadFromDTrow(e),t.parent_message_id!=t.message_id){getMsgDict(t.parent_message_id,{context:"display",display_type:"dialog"})}else $("#parent_msg").html(""),$("#parent_msg_div").hide();var o=getFileReferences(t.message_id);if(0<o.length){$("#files_rfrncd_div_dialog").show();for(var n="",a=0;a<o.length;a++){var i=o[a],r=1<i.upload_file_name.length?" ("+i.upload_file_name+")":"";n+='<p><span class=""><a href="'+i.relative_file_url+'" target="_blank">'+i.file_name+r+"</a></span></p>"}$("#files_rfrncd_dialog").html(n)}else $("#files_rfrncd_dialog").html(""),$("#files_rfrncd_div_dialog").hide();if($("#msg_dep_id").html(MsgingMod.sCrrntDataSetID),$("#msg_id").val(t.message_id),$("#msg_ordinal_id").html(t.ordinal_id),$("#msg_subject").html(t.message_subject),$("#msg_sender").html(t.sender),$("#msg_timestamp").html(t.timestamp),$("#msg_body").html(t.message_text),MsgingMod.bCorrspndncHstryStndaln||markMsgAsRead(t.message_id),s){var d=screen.width-100,g=screen.height-200;window.open(MsgingMod.URL.DISPLAY_MSG+"?annotator="+MsgingMod.sAnnotator+"&msg_id="+t.message_id+"&sessionid="+MsgingMod.sSessionId+"&identifier="+MsgingMod.sCrrntDataSetID+"&filesource="+MsgingMod.sFileSource+"&content_type="+MsgingMod.sCrrntContentType,"dsplyMsgWndw"+t.message_id,"width="+d+", height="+g+", top=50, left=50, menubar=no, status=no, toolbar=no, titlebar=no, location=no, scrollbars=yes")}else $("#msg_body_display").modal("show")}function getMsgDict(o,n){var a=new Message;return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.GET_MSG,async:!0,clearForm:!1,dataType:"json",beforeSubmit:function(e,s,t){e.push({name:"msg_id",value:o})},success:function(e){if(e.msg_dict&&(a.loadFromJson(e.msg_dict),void 0!==n.context))if("compose"===n.context){var s=void 0!==n.msg_prefix?n.msg_prefix+a.message_subject:void 0!==n.msg_subject?n.msg_subject:"[SUBJECT PLACHEHOLDER]",t=void 0!==n.msg_text?n.msg_text:"";n.callback(s,a.message_id,a.message_text,a.sender,a.timestamp,void 0),$("#msg_compose_body").val(t)}else if("propagate"===n.context){var o=void 0!==n.propagate_type?n.propagate_type:"error";n.callback(a.message_subject,a.message_id,a.message_text,a.sender,a.timestamp,o)}else"display"===n.context&&void 0!==n.display_type&&a.message_text&&void 0!==a.message_text&&("preview_pane"===n.display_type?($("#preview_parent_msg_div").show(),$("#preview_parent_msg").html('<p><span class="strong">SENDER:</span> '+a.sender+'</p><p><span class="strong">DATE/TIME:</span> '+a.timestamp+"</p><p>"+a.message_text+"</p>")):"dialog"===n.display_type&&($("#parent_msg_div").show(),$("#parent_msg").html('<p><span class="strong">SENDER:</span> '+a.sender+'</p><p><span class="strong">DATE/TIME:</span> '+a.timestamp+"</p><p>"+a.message_text+"</p>")))}}),!1}function markMsgAsRead(o){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.MARK_MSG_READ,async:!0,clearForm:!1,beforeSubmit:function(e,s,t){e.push({name:"msg_id",value:o})},success:function(){MsgingMod.arrMsgsAlreadyRead.push(o),checkGlobalMsgStatus()}}),!1}function tagMsg(o,n,a){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.TAG_MSG,async:!0,clearForm:!1,beforeSubmit:function(e,s,t){e.push({name:"msg_id",value:MsgingMod.sCrrntMsgIdSlctd}),e.push({name:"action_reqd",value:o}),e.push({name:"read_status",value:n}),e.push({name:"for_release",value:a})},success:function(){var e=MsgingMod.arrMsgsForRelease.indexOf(MsgingMod.sCrrntMsgIdSlctd),s=MsgingMod.arrMsgsAlreadyRead.indexOf(MsgingMod.sCrrntMsgIdSlctd),t=MsgingMod.arrMsgsNoActionReqd.indexOf(MsgingMod.sCrrntMsgIdSlctd);"N"==o?t<0&&MsgingMod.arrMsgsNoActionReqd.push(MsgingMod.sCrrntMsgIdSlctd):-1<t&&MsgingMod.arrMsgsNoActionReqd.splice(t,1),"Y"==a?e<0&&MsgingMod.arrMsgsForRelease.push(MsgingMod.sCrrntMsgIdSlctd):-1<e&&MsgingMod.arrMsgsForRelease.splice(e,1),"N"==n&&-1<s&&MsgingMod.arrMsgsAlreadyRead.splice(s,1),checkGlobalMsgStatus()}}),!1}function progressStart(){$("#loading").fadeIn("slow").spin("large","black")}function progressEnd(){$("#loading").fadeOut("fast").spin(!1)}function submitNewMsg(o){var e;e="sentmsgs"==MsgingMod.sViewContext||1==MsgingMod.bNewDraftContext?MsgingMod.URL.SUBMIT_MSG:MsgingMod.URL.UPDATE_DRAFT_STATE;var n=document.location.hostname;$("#msg_compose_frm").ajaxSubmit({url:e,async:!0,clearForm:!1,beforeSubmit:function(e,s,t){e.push({name:"send_status",value:o}),e.push({name:"filesource",value:MsgingMod.sFileSource}),e.push({name:"content_type",value:MsgingMod.sCrrntContentType}),e.push({name:"hostname",value:n}),e.push({name:"msgs_high_watermark",value:MsgingMod.iCrrntMsgsHwm}),e.push({name:"notes_high_watermark",value:MsgingMod.iCrrntNotesHwm})},success:function(e){if("true"==e.success){getFilesReferenced(),"Y"==o&&checkGlobalMsgStatus(),"true"!=String(e.pdbx_model_updated)&&progressEnd(),"sentmsgs"==MsgingMod.sViewContext?reLoadMsgs():loadDrafts();try{"true"==String(e.pdbx_model_updated)?(console.log("about to dodepuireset"),$.when(promise_dodepuireset(MsgingMod.sSessionId,MsgingMod.sDepId,!1)).done(function(){console.log("promise depuireset done"),progressEnd()}).fail(function(){console.log("promise depuireset fail done"),progressEnd()})):String(e.pdbx_model_updated)}catch(e){alert("Problem when application made request to have DEP UI reset. err="+e.message)}}else{var s="There was a problem submitting the message.",t="";1<e.append_msg.length&&(t=String(e.append_msg)),1<t.length&&(s=s+" "+t),alert(s)}}})}function propagateMsg(o,e,s,n,a,t){var i="archive"==t?MsgingMod.URL.ARCHIVE_MSG:MsgingMod.URL.FORWARD_MSG,r="archive"==t?$("#archive_msg_target_depid").val():$("#forward_msg_target_depid").val(),d=document.location.hostname,g="",l=getFileReferences(e);if(0<l.length)for(var _="",c=0;c<l.length;c++){var m=l[c],M=1<m.upload_file_name.length?" ("+m.upload_file_name+")":"";0<c&&(_=", "),g+=_+m.file_name+M}var p="ORIG MESSAGE SENDER: "+n+"\nORIG MESSAGE DATETIME: "+a+"\n\nORIG MESSAGE BODY:\n\n"+s+"\n\nORIG FILE REFERENCES: "+g;$("#hlprfrm").ajaxSubmit({url:i,async:!0,clearForm:!1,type:"POST",beforeSubmit:function(e,s,t){e.push({name:"send_status",value:"Y"}),e.push({name:"filesource",value:MsgingMod.sFileSource}),e.push({name:"content_type",value:MsgingMod.sCrrntContentType}),e.push({name:"hostname",value:d}),e.push({name:"subject",value:o}),e.push({name:"message",value:p}),e.push({name:"mode",value:"manual"}),e.push({name:"target_identifier",value:r}),e.push({name:"orig_sender",value:n}),e.push({name:"orig_recipient",value:"MessagingModule"}),e.push({name:"orig_date",value:a}),e.push({name:"orig_subject",value:o}),e.push({name:"orig_attachments",value:g})},success:function(e){if(e.success)for(var s in e.success)"job"==s?"error"==e.success[s]&&(alert("An application error has occurred while executing this request."),!0):"false"==e.success[s]&&(alert("Problem on attempt to "+t+" message for dep ID: "+s+". Please verify that this is a valid dep ID."),!0)}})}function convertColNameToIntIndex(e){var s=-1;for(x=0;x<MsgingMod.arrOrderedColumnList.length;x++)e==MsgingMod.arrOrderedColumnList[x]&&(s=x);return s}function getTrueColIdx(e){return 0==MsgingMod.iCnt_DrawBackCalledOnCurrentTbl?iTrueColIdx=e:iTrueColIdx=MsgingMod.arrColDisplOrderCorrHx[e],iTrueColIdx}function applySearchHeaderFunctions(e){var s="#"+MsgingMod.sCrrntDataSetID+"_tbl_wrapper div.dataTables_scrollHead thead input";$(s).keyup(function(){e.fnFilter(this.value,getTrueColIdx($(s).index(this)))})}function loadTestExampleSeeJson(o){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.SEE_RAW_JSON_FOR_DTBL,async:!0,clearForm:!1,target:"#rslts",beforeSubmit:function(e,s,t){e.push({name:"identifier",value:o})},success:function(){}}),!1}