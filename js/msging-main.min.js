function getMsgTemplates(){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.GET_MSG_TMPLTS,clearForm:!1,dataType:"json",success:function(a){$("#msg_compose_frm").after(a.html),MsgingMod.bEmEntry="true"===$("#em_entry").text(),$("#msg_compose_input_em_entry").val($("#em_entry").text()),MsgingMod.bEmMapOnly="true"===$("#maponly").text(),$("#msg_compose_input_em_map_only").val($("#maponly").text()),MsgingMod.bEmMapOnly&&$("#cmps_default").parent().after('<li id="li_maponly-authstatus-em"><a href="#" class="compose" id="cmps_maponly-authstatus-em">EM Map-Only Post-Annotation</a></li>'),MsgingMod.bEmMapAndModel="true"===$("#mapandmodel").text(),$("#msg_compose_input_em_map_and_model").val($("#mapandmodel").text()),MsgingMod.sAccessionIdString=$("#accession_ids").text(),MsgingMod.sAccessionIdStringEmRel=$("#accession_ids_em_rel").text(),MsgingMod.sPdbId=$("#pdb_id").text(),MsgingMod.sDefaultMsgType=$("#default_msg_tmplt").text(),$("#new_msg_menu").removeClass("disabled").addClass("hoveractivate"),$("#new_msg_menu_link").removeClass("disabled"),$("#tmplts_loading_prompt_a").removeClass("bg-warning").addClass("bg-success").html("<strong>Message templates now loaded</strong>"),$("#tmplts_loading_prompt").fadeOut(4e3,function(){$("#tmplts_loading_prompt").addClass("hidden")}),1==MsgingMod.bEmbeddedView&&"msgs"==MsgingMod.sCrrntContentType&&1==AUTO_LAUNCH_COMPOSE&&(composeMsg(void 0,void 0,void 0,void 0,void 0,MsgingMod.sDefaultMsgType),AUTO_LAUNCH_COMPOSE=!1)}}),!1}function loadDrafts(){MsgingMod.sCrrntDataSetID=MsgingMod.sDepId,MsgingMod.sUseThreaded="false",MsgingMod.bAllowSorting=!0,MsgingMod.iCnt_DrawBackCalledOnCurrentTbl=0,loadMsgsDT("N")}function redrawTable(a){a="undefined"!=typeof a?a:!0;var b=$("#"+MsgingMod.sDepId+"_tbl").DataTable(),c=!a;b.draw(c)}function loadCommHstry(){MsgingMod.sUseThreaded="false",MsgingMod.bAllowSorting=!0,$("#depdatasetid").show().html("Deposition Dataset ID: "+MsgingMod.sCrrntDataSetID),MsgingMod.iCnt_DrawBackCalledOnCurrentTbl=0,MsgingMod.sCrrntContentType="commhstry",loadCommHstryDT(MsgingMod.sCrrntDataSetID)}function markRowAsSelected(a,b){var c=$(a).attr("id");$("#rslts table.DTFC_Cloned #"+c).hasClass("row_selected")||$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+c).hasClass("row_selected")?b||($("#rslts table.DTFC_Cloned #"+c).removeClass("row_selected"),$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+c).removeClass("row_selected"),MsgingMod.sCrrntRowSlctd=""):$("#rslts tbody tr.row_selected").removeClass("row_selected"),$("#rslts table.DTFC_Cloned #"+c).addClass("row_selected"),$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+c).addClass("row_selected"),MsgingMod.sCrrntRowSlctd=c;var d=MsgingMod.oDataTable.fnGetPosition(a),e=MsgingMod.oDataTable.fnGetData(d).message_id;MsgingMod.sCrrntMsgIdSlctd=e}function promptForMsgTags(a,b){"msgs"==MsgingMod.sCrrntContentType&&$(a).hasClass("row_selected")&&$(a).hasClass("msg_read")&&($("#chckbx_unread input").prop("checked",!1),$(a).hasClass("frm_annotator")?($("#chckbx_no_action_reqd input").prop("checked",!0),$("#chckbx_no_action_reqd").addClass("hidden")):($("#chckbx_no_action_reqd").removeClass("hidden"),$(a).hasClass("no_action_reqd")?$("#chckbx_no_action_reqd input").prop("checked",!0):$("#chckbx_no_action_reqd input").prop("checked",!1)),$(a).hasClass("for_release")?$("#chckbx_for_release input").prop("checked",!0):$("#chckbx_for_release input").prop("checked",!1),$("#tag_msg").modal("show"))}function closeWindow(){"Microsoft Internet Explorer"==navigator.appName?(this.focus(),self.opener=this,self.close()):(window.open("","_parent",""),window.close())}function iframeCloser(){var a=window.location!=window.parent.location;if(a){var b=null;b=window.parent!=window.top?window.top:window.parent,$.isFunction(b.hideEditFrame)?(console.log("Invoking iframe close method"),b.hideEditFrame()):console.log(">>>WARNING -Can't find iframe destroy method")}}function checkGlobalMsgStatus(){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.CHECK_GLBL_MSG_STATUS,async:!0,clearForm:!1,success:function(a){if(a)if("true"==a.all_msgs_read,"true"==a.all_msgs_actioned,"true"==a.any_notes_exist?MsgingMod.bNotesExist=!0:MsgingMod.bNotesExist=!1,"undefined"!=typeof a.num_notes_records&&a.num_notes_records>=0&&(MsgingMod.iCrrntNotesHwm=a.num_notes_records),a.notes_flag_active&&a.notes_flag_active.length&&(MsgingMod.sNotesFlagActive=String(a.notes_flag_active),"true"==MsgingMod.sNotesFlagActive?$("#notes_flag_toggle").text(MsgingMod.LABEL.TURN_OFF_NOTES_FLAG):$("#notes_flag_toggle").text(MsgingMod.LABEL.TURN_ON_NOTES_FLAG)),a.notes_flag_active_bmrb&&a.notes_flag_active_bmrb.length&&($("#notes_flag_bmrb_toggle").removeClass("hidden"),MsgingMod.sNotesFlagActiveBmrb=String(a.notes_flag_active_bmrb),"true"==MsgingMod.sNotesFlagActiveBmrb?$("#notes_flag_bmrb_toggle").text(MsgingMod.LABEL.TURN_OFF_NOTES_FLAG_BMRB):$("#notes_flag_bmrb_toggle").text(MsgingMod.LABEL.TURN_ON_NOTES_FLAG_BMRB)),MsgingMod.bNotesExist){var b={color:"#FF0000",borderColor:"#FF0000 rgb(82, 82, 82)",fontWeight:"bold"};$("#get_content_type_notes").css(b),$("#get_content_type_notes").bt("There are notes present for this deposition.",{positions:["top","right"],trigger:"hoverIntent",hoverIntentOpts:{interval:850}})}else $("#get_content_type_notes").bt("There are currently no notes for this deposition.",{positions:["top","right"],trigger:"hoverIntent",hoverIntentOpts:{interval:850}})}}),!1}function toggleNotesFlagging(a){var b=a||"",c=b.length>1?"activate_notes_flagging_"+b:"activate_notes_flagging",d=b.length>1?MsgingMod.sNotesFlagActiveBmrb:MsgingMod.sNotesFlagActive;return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.TOGGLE_NOTES_FLAGGING,async:!0,clearForm:!1,beforeSubmit:function(a,e,f){a.push({name:c,value:d}),b&&a.push({name:"subtype",value:"bmrb"})},success:function(a){checkGlobalMsgStatus()}}),!1}function getFilesReferenced(){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.GET_FILES_RFRNCD,async:!0,clearForm:!1,success:function(a){a&&(MsgingMod.oFilesRfrncd=a.files_rfrncd)}}),!1}function confirmAvailFiles(a){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.CHECK_AVAIL_FILES,async:!0,clearForm:!1,success:function(b){b&&(MsgingMod.arrAvailFiles=b.file_list),"function"==typeof a&&a()}}),!1}function autoLoadMsgs(){MsgingMod.sCrrntDataSetID=MsgingMod.sDepId,MsgingMod.sUseThreaded="false",MsgingMod.bAllowSorting=!0,$("#depdatasetid").show().html("Deposition Dataset ID: "+MsgingMod.sDepId),MsgingMod.iCnt_DrawBackCalledOnCurrentTbl=0,loadMsgsDT("Y")}function Message(){this.message_subject,this.message_id,this.ordinal_id,this.message_text,this.sender,this.timestamp,this.parent_message_id,this.loadFromJson=function(a){this.message_subject=a.message_subject,this.message_id=a.message_id,this.message_text=a.message_text,this.sender=a.sender,this.timestamp=a.timestamp,this.parent_message_id=a.parent_message_id},this.loadFromDTrow=function(a){var b=($("td",a),MsgingMod.oDataTable.fnGetPosition(a));this.message_subject=MsgingMod.oDataTable.fnGetData(b).message_subject,this.sender=MsgingMod.oDataTable.fnGetData(b).sender,this.timestamp=MsgingMod.oDataTable.fnGetData(b).timestamp,this.message_text=MsgingMod.oDataTable.fnGetData(b).message_text,this.message_id=MsgingMod.oDataTable.fnGetData(b).message_id,this.ordinal_id=MsgingMod.oDataTable.fnGetData(b).ordinal_id,this.parent_message_id=MsgingMod.oDataTable.fnGetData(b).parent_message_id}}function reLoadMsgs(){var a="sentmsgs"==MsgingMod.sViewContext?"Y":"N";loadMsgsDT(a)}function loadMsgsDT(sendStatusToUse){"Y"==sendStatusToUse?(MsgingMod.sViewContext="sentmsgs",$("#tag_msg_choice").removeClass("ui-state-disabled")):(MsgingMod.sViewContext="drafts",$("#tag_msg_choice").addClass("ui-state-disabled"));var sContentType;return"notes"==MsgingMod.sCrrntContentType?(sContentType=MsgingMod.sCrrntContentType,$("#tag_msg_choice").addClass("ui-state-disabled")):"msgs"==MsgingMod.sCrrntContentType&&(sContentType="messages"),$("#hlprfrm_content_type").val(MsgingMod.sCrrntContentType),$("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.DTBL_GET_TMPLT,async:!0,clearForm:!1,dataType:"json",beforeSubmit:function(a,b,c){a.push({name:"serverside",value:MsgingMod.sUseServerSidePrcssing}),a.push({name:"usethreaded",value:MsgingMod.sUseThreaded}),a.push({name:"send_status",value:sendStatusToUse})},success:function(jsonData){if(MsgingMod.sCrrntDataSetID=MsgingMod.sDepId,$("#rslts").html(jsonData.html),jsonData.dtbl_config_dict){"undefined"!=typeof jsonData.dtbl_config_dict.CURRENT_NUM_MSGS_TO_DPSTR&&null!=jsonData.dtbl_config_dict.CURRENT_NUM_MSGS_TO_DPSTR&&(MsgingMod.iCrrntMsgsHwm=jsonData.dtbl_config_dict.CURRENT_NUM_MSGS_TO_DPSTR),"undefined"!=typeof jsonData.dtbl_config_dict.CURRENT_NUM_NOTES&&null!=jsonData.dtbl_config_dict.CURRENT_NUM_NOTES&&(MsgingMod.iCrrntNotesHwm=jsonData.dtbl_config_dict.CURRENT_NUM_NOTES),"undefined"!=typeof jsonData.dtbl_config_dict.MSGS_ALREADY_READ&&null!=jsonData.dtbl_config_dict.MSGS_ALREADY_READ&&(MsgingMod.arrMsgsAlreadyRead=jsonData.dtbl_config_dict.MSGS_ALREADY_READ),"undefined"!=typeof jsonData.dtbl_config_dict.MSGS_FOR_RELEASE&&null!=jsonData.dtbl_config_dict.MSGS_FOR_RELEASE&&(MsgingMod.arrMsgsForRelease=jsonData.dtbl_config_dict.MSGS_FOR_RELEASE),"undefined"!=typeof jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD&&null!=jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD&&(MsgingMod.arrMsgsNoActionReqd=jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD),"undefined"!=typeof jsonData.dtbl_config_dict.ORDERED_COLUMN_LIST&&null!=jsonData.dtbl_config_dict.ORDERED_COLUMN_LIST&&(MsgingMod.arrOrderedColumnList=jsonData.dtbl_config_dict.ORDERED_COLUMN_LIST);var oTable=$("#"+MsgingMod.sDepId+"_tbl").dataTable({sDom:'R<"depdatasetlabel fltlft"><"fltrgt"f>tlip',oLanguage:{sSearch:"Search "+sContentType+":",sEmptyTable:"No messages to display"},bProcessing:!1,bServerSide:eval(MsgingMod.sUseServerSidePrcssing),sAjaxSource:MsgingMod.URL.DTBL_AJAX_LOAD,fnServerParams:function(a){a.push({name:"identifier",value:MsgingMod.sDepId}),a.push({name:"sessionid",value:MsgingMod.sSessionId}),a.push({name:"filesource",value:MsgingMod.sFileSource}),a.push({name:"serverside",value:MsgingMod.sUseServerSidePrcssing}),a.push({name:"usethreaded",value:MsgingMod.sUseThreaded}),a.push({name:"send_status",value:sendStatusToUse}),a.push({name:"content_type",value:MsgingMod.sCrrntContentType})},bScrollCollapse:!0,bPaginate:!1,sScrollY:MsgingMod.iScrollY_Msgs+"px",bFilter:!0,bSortCellsTop:MsgingMod.bAllowSorting,bSort:MsgingMod.bAllowSorting,bInfo:!0,bAutoWidth:!0,fnInitComplete:function(a,b){$("#rslts_resize_container").height($("#rslts #"+MsgingMod.sDepId+"_tbl_wrapper .dataTables_scroll .dataTables_scrollBody").height()+110);var c="notes"==MsgingMod.sCrrntContentType?"Annotator Processing Notes":"Communications with Depositor";$(".depdatasetlabel").html("<h4>"+MsgingMod.sDisplayId+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+c+"</h4>"),"notes"==MsgingMod.sCrrntContentType?$("h2, h3, h4").css("color",MsgingMod.STYLE.COLOR_NOTES):$("h2, h3, h4").css("color",MsgingMod.STYLE.COLOR_MSGS),$("tr.srch_hdrs").hide();var d=$("#rslts #"+MsgingMod.sDepId+"_tbl.dataTable tbody tr#row_0.dt_row")[0];"undefined"!=typeof d?(markRowAsSelected(d,!1),1==MsgingMod.bMsgPanelShown&&previewMsg(d)):(MsgingMod.sCrrntRowSlctd="",1==MsgingMod.bMsgPanelShown&&$("#collapse_msg_preview").collapse("hide"))},fnDrawCallback:function(){if(MsgingMod.iCnt_DrawBackCalledOnCurrentTbl+=1,MsgingMod.iDTscrollTopSaved>0&&$("#rslts #"+MsgingMod.sDepId+"_tbl_wrapper .dataTables_scroll .dataTables_scrollBody").scrollTop(MsgingMod.iDTscrollTopSaved),MsgingMod.sCrrntRowSlctd.length>0){var a=$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+MsgingMod.sCrrntRowSlctd)[0];if("undefined"!=typeof a){markRowAsSelected(a,!1);for(var b=MsgingMod.oDataTable.fnGetPosition(a),c=MsgingMod.oDataTable.fnGetData(b).message_id,d=!1,e=!1,f=!1,g=0;g<MsgingMod.arrMsgsAlreadyRead.length;g++)if(c==MsgingMod.arrMsgsAlreadyRead[g]){$(a).addClass("msg_read"),d=!0;break}if(d||$(a).removeClass("msg_read"),"msgs"==MsgingMod.sCrrntContentType){for(var g=0;g<MsgingMod.arrMsgsNoActionReqd.length;g++)if(c==MsgingMod.arrMsgsNoActionReqd[g]){$(a).addClass("no_action_reqd"),$(a).removeClass("action_reqd"),$(a).find("td:first").css("background","none"),f=!0;break}f||($(a).removeClass("no_action_reqd"),$(a).addClass("action_reqd"),$(a).find("td:first").css("background","url('/msgmodule/images/stock_todo.png') no-repeat center left"));for(var g=0;g<MsgingMod.arrMsgsForRelease.length;g++)if(c==MsgingMod.arrMsgsForRelease[g]){$(a).addClass("for_release"),$(a).find("td:first").css("background","url('/msgmodule/images/release.png') no-repeat center left"),e=!0;break}e||($(a).removeClass("for_release"),f&&$(a).find("td:first").css("background","none"))}}}$("#rslts_resize_container").resizable({handles:"s",minHeight:MsgingMod.iScrollY_Msgs}),$("#rslts_resize_container").resize(function(){var a=MsgingMod.oDataTable.fnSettings();a.oScroll.sY=calcDataTableHeight()})},aoColumns:jsonData.dtbl_config_dict.DTBL_AOCOLUMNS,aaSorting:[[convertColNameToIntIndex("timestamp"),"desc"]],aoColumnDefs:[{aTargets:[convertColNameToIntIndex("ordinal_id"),convertColNameToIntIndex("message_id"),convertColNameToIntIndex("deposition_data_set_id"),convertColNameToIntIndex("context_type"),convertColNameToIntIndex("context_value"),convertColNameToIntIndex("parent_message_id"),convertColNameToIntIndex("message_text"),convertColNameToIntIndex("message_type"),convertColNameToIntIndex("send_status")],bVisible:!1},{aTargets:[convertColNameToIntIndex("message_subject")],sWidth:"62%",fnCreatedCell:function(a,b,c,d,e){var f=$(a),g=!0;jsonData.dtbl_config_dict.INDENT_DICT?f.addClass("indent_"+jsonData.dtbl_config_dict.INDENT_DICT[c.message_id]):"msgs"==MsgingMod.sCrrntContentType&&"sentmsgs"==MsgingMod.sViewContext&&f.addClass("indent_0");for(var h=0;h<jsonData.dtbl_config_dict.MSGS_ALREADY_READ.length;h++)c.message_id==jsonData.dtbl_config_dict.MSGS_ALREADY_READ[h]&&f.parent().addClass("msg_read");if("msgs"==MsgingMod.sCrrntContentType){f.parent().addClass("action_reqd"),f.css("background","url('/msgmodule/images/stock_todo.png') no-repeat center left");for(var h=0;h<jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD.length;h++)if(c.message_id==jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD[h]){f.parent().addClass("no_action_reqd"),f.parent().removeClass("action_reqd"),g=!1,f.css("background","none");break}for(var h=0;h<MsgingMod.arrMsgsNoActionReqd.length;h++)if(c.message_id==MsgingMod.arrMsgsNoActionReqd[h]){f.parent().addClass("no_action_reqd"),f.parent().removeClass("action_reqd"),g=!1,f.css("background","none");break}}f.parent().removeClass("for_release"),g||f.css("background","none");for(var h=0;h<jsonData.dtbl_config_dict.MSGS_FOR_RELEASE.length;h++)if(c.message_id==jsonData.dtbl_config_dict.MSGS_FOR_RELEASE[h]){f.parent().addClass("for_release"),f.css("background","url('/msgmodule/images/release.png') no-repeat center left");break}}},{aTargets:[convertColNameToIntIndex("sender")],sWidth:"28%",fnCreatedCell:function(a,b,c,d,e){var f=$(a);b.startsWith("depositor")||f.parent().addClass("frm_annotator")}},{aTargets:[convertColNameToIntIndex("timestamp")],sWidth:"10%"}],oColReorder:{aiOrder:[convertColNameToIntIndex("message_subject"),convertColNameToIntIndex("sender"),convertColNameToIntIndex("timestamp"),convertColNameToIntIndex("ordinal_id"),convertColNameToIntIndex("message_id"),convertColNameToIntIndex("deposition_data_set_id"),convertColNameToIntIndex("context_type"),convertColNameToIntIndex("context_value"),convertColNameToIntIndex("parent_message_id"),convertColNameToIntIndex("message_text"),convertColNameToIntIndex("message_type"),convertColNameToIntIndex("send_status")]}});MsgingMod.oDataTable=oTable}"notes"==MsgingMod.sCrrntContentType?($(".notes_view_only").show(),$("#get_content_type_notes").parent().addClass("active"),$(".msg_view_only").hide()):($(".msg_view_only").show(),$(".notes_view_only").hide(),"sentmsgs"==MsgingMod.sViewContext?($("#threaded_view_toggle").show(),$("#get_content_type_msgs").parent().addClass("active")):($("#threaded_view_toggle").hide(),$("#get_draft_msgs").parent().addClass("active"))),$("#archive_display").show()}}),!1}function loadCommHstryDT(){return MsgingMod.sViewContext="sentmsgs",$("#hlprfrm_content_type").val(MsgingMod.sCrrntContentType),$("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.DTBL_GET_TMPLT,async:!0,clearForm:!1,dataType:"json",beforeSubmit:function(a,b,c){a.push({name:"serverside",value:MsgingMod.sUseServerSidePrcssing}),a.push({name:"usethreaded",value:MsgingMod.sUseThreaded}),a.push({name:"send_status",value:"Y"})},success:function(jsonData){if(MsgingMod.sCrrntDataSetID=MsgingMod.sDepId,$("#rslts").html(jsonData.html),jsonData.dtbl_config_dict){"undefined"!=typeof jsonData.dtbl_config_dict.MSGS_ALREADY_READ&&null!=jsonData.dtbl_config_dict.MSGS_ALREADY_READ&&(MsgingMod.arrMsgsAlreadyRead=jsonData.dtbl_config_dict.MSGS_ALREADY_READ),"undefined"!=typeof jsonData.dtbl_config_dict.ORDERED_COLUMN_LIST&&null!=jsonData.dtbl_config_dict.ORDERED_COLUMN_LIST&&(MsgingMod.arrOrderedColumnList=jsonData.dtbl_config_dict.ORDERED_COLUMN_LIST,MsgingMod.arrColDisplOrderCorrHx=[convertColNameToIntIndex("message_subject"),convertColNameToIntIndex("sender"),convertColNameToIntIndex("timestamp"),convertColNameToIntIndex("orig_sender"),convertColNameToIntIndex("orig_timestamp"),convertColNameToIntIndex("orig_recipient"),convertColNameToIntIndex("orig_message_subject"),convertColNameToIntIndex("orig_attachments"),convertColNameToIntIndex("ordinal_id"),convertColNameToIntIndex("message_id"),convertColNameToIntIndex("deposition_data_set_id"),convertColNameToIntIndex("context_type"),convertColNameToIntIndex("context_value"),convertColNameToIntIndex("parent_message_id"),convertColNameToIntIndex("message_text"),convertColNameToIntIndex("message_type"),convertColNameToIntIndex("send_status"),convertColNameToIntIndex("orig_message_id"),convertColNameToIntIndex("orig_deposition_data_set_id")]);var mColumns=[0,1,2,3,4,5,6,7,10],oTable=$("#"+MsgingMod.sDepId+"_tbl").dataTable({sDom:'R<"depdatasetlabel fltlft"><"fltrgt"f>tlip<"clearfloat">T',tableTools:{sSwfPath:"/msgmodule/swf/copy_csv_xls_pdf.swf",aButtons:[{sExtends:"xls",sButtonText:"Excel (tab delim file)",mColumns:mColumns},{sExtends:"copy",mColumns:mColumns},"print"]},oLanguage:{sSearch:"Search Comm History:",sEmptyTable:"No messages to display"},bSortCellsTop:!0,bProcessing:!1,bServerSide:eval(MsgingMod.sUseServerSidePrcssing),sAjaxSource:MsgingMod.URL.DTBL_AJAX_LOAD,fnServerParams:function(a){a.push({name:"identifier",value:MsgingMod.sDepId}),a.push({name:"sessionid",value:MsgingMod.sSessionId}),a.push({name:"filesource",value:MsgingMod.sFileSource}),a.push({name:"serverside",value:MsgingMod.sUseServerSidePrcssing}),a.push({name:"usethreaded",value:MsgingMod.sUseThreaded}),a.push({name:"send_status",value:"Y"}),a.push({name:"content_type",value:MsgingMod.sCrrntContentType})},bScrollCollapse:!0,bPaginate:!1,sScrollY:MsgingMod.iScrollY_CommHstry+"px",bFilter:!0,bSort:eval(MsgingMod.bAllowSorting),bInfo:!0,bAutoWidth:!1,fnInitComplete:function(a,b){$("#rslts_resize_container").height($("#rslts #"+MsgingMod.sDepId+"_tbl_wrapper .dataTables_scroll .dataTables_scrollBody").height()+220),$(window).resize(function(){MsgingMod.oDataTable.fnAdjustColumnSizing()}),$(".depdatasetlabel").html("<h4>"+MsgingMod.sDepId+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Complete Correspondence History</h4>"),"commhstry"==MsgingMod.sCrrntContentType?$("h2, h3, h4").css("color",MsgingMod.STYLE.COLOR_COMMHSTRY):$("h2, h3, h4").css("color",MsgingMod.STYLE.COLOR_MSGS),$("tr.srch_hdrs").show(),oTable.fnDraw(),oTable.fnAdjustColumnSizing();var c=$("#rslts #"+MsgingMod.sDepId+"_tbl.dataTable tbody tr#row_0.dt_row")[0];"undefined"!=typeof c?(markRowAsSelected(c,!1),1==MsgingMod.bMsgPanelShown&&previewMsg(c)):1==MsgingMod.bMsgPanelShown&&$("#collapse_msg_preview").collapse("hide")},aoColumns:jsonData.dtbl_config_dict.DTBL_AOCOLUMNS,aaSorting:[[convertColNameToIntIndex("timestamp"),"desc"]],aoColumnDefs:[{aTargets:[convertColNameToIntIndex("ordinal_id"),convertColNameToIntIndex("message_id"),convertColNameToIntIndex("deposition_data_set_id"),convertColNameToIntIndex("context_type"),convertColNameToIntIndex("context_value"),convertColNameToIntIndex("parent_message_id"),convertColNameToIntIndex("message_text"),convertColNameToIntIndex("message_type"),convertColNameToIntIndex("send_status"),convertColNameToIntIndex("orig_message_id"),convertColNameToIntIndex("orig_deposition_data_set_id")],bVisible:!1},{aTargets:[convertColNameToIntIndex("message_subject")],sWidth:"25%",fnCreatedCell:function(a,b,c,d,e){var f=$(a),g=!0;f.addClass("indent_0");for(var h=0;h<jsonData.dtbl_config_dict.MSGS_ALREADY_READ.length;h++)c.message_id==jsonData.dtbl_config_dict.MSGS_ALREADY_READ[h]&&f.parent().addClass("msg_read");for(var h=0;h<MsgingMod.arrMsgsAlreadyRead.length;h++)c.message_id==MsgingMod.arrMsgsAlreadyRead[h]&&f.parent().addClass("msg_read");f.parent().addClass("action_reqd"),f.css("background","url('/msgmodule/images/stock_todo.png') no-repeat center left");for(var h=0;h<jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD.length;h++)if(c.message_id==jsonData.dtbl_config_dict.MSGS_NO_ACTION_REQD[h]){f.parent().addClass("no_action_reqd"),f.parent().removeClass("action_reqd"),g=!1,f.css("background","none");break}for(var h=0;h<jsonData.dtbl_config_dict.NOTES_MSG_IDS.length;h++)if(c.message_id==jsonData.dtbl_config_dict.NOTES_MSG_IDS[h]){f.parent().addClass("no_action_reqd"),f.parent().removeClass("action_reqd"),g=!1,f.css("background","none");break}f.parent().removeClass("for_release"),g||f.css("background","none");for(var h=0;h<jsonData.dtbl_config_dict.MSGS_FOR_RELEASE.length;h++)if(c.message_id==jsonData.dtbl_config_dict.MSGS_FOR_RELEASE[h]){f.parent().addClass("for_release"),f.css("background","url('/msgmodule/images/release.png') no-repeat center left");break}}},{aTargets:[convertColNameToIntIndex("sender")],sWidth:"8%"},{aTargets:[convertColNameToIntIndex("timestamp")],sWidth:"10%"},{aTargets:[convertColNameToIntIndex("orig_sender")],sWidth:"8%"},{aTargets:[convertColNameToIntIndex("orig_timestamp")],sWidth:"10%"},{aTargets:[convertColNameToIntIndex("orig_recipient")],sWidth:"8%"},{aTargets:[convertColNameToIntIndex("orig_message_subject")],sWidth:"25%"},{aTargets:[convertColNameToIntIndex("orig_attachments")],sWidth:"5%"}],fnDrawCallback:function(){if(MsgingMod.iCnt_DrawBackCalledOnCurrentTbl+=1,applySearchHeaderFunctions(oTable),MsgingMod.iDTscrollTopSaved>0&&$("#rslts #"+MsgingMod.sDepId+"_tbl_wrapper .dataTables_scroll .dataTables_scrollBody").scrollTop(MsgingMod.iDTscrollTopSaved),MsgingMod.sCrrntRowSlctd.length>0){var a=$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+MsgingMod.sCrrntRowSlctd)[0];if("undefined"!=typeof a){markRowAsSelected(a,!1);for(var b=MsgingMod.oDataTable.fnGetPosition(a),c=MsgingMod.oDataTable.fnGetData(b).message_id,d=!1,e=0;e<MsgingMod.arrMsgsAlreadyRead.length;e++)if(c==MsgingMod.arrMsgsAlreadyRead[e]){$(a).addClass("msg_read"),d=!0;break}d||$(a).removeClass("msg_read")}}$("#rslts_resize_container").resizable({handles:"s",minHeight:MsgingMod.iScrollY_CommHstry+125}),$("#rslts_resize_container").resize(function(){var a=MsgingMod.oDataTable.fnSettings();a.oScroll.sY=calcDataTableHeight(),MsgingMod.oDataTable.fnAdjustColumnSizing()})},oColReorder:{aiOrder:MsgingMod.arrColDisplOrderCorrHx}});MsgingMod.oDataTable=oTable}$("#get_content_type_commhstry").parent().addClass("active"),$(".notes_view_only").hide(),$(".msg_view_only").hide(),$("#archive_display").hide()}}),!1}function clearFileUpload(a){if("all"==a)for(var b=1;4>b;b++)$("#aux-file"+b).replaceWith('<input type="file" size="50" id="aux-file'+b+'" name="aux-file'+b+'" class="c_'+MsgingMod.sDepId+' file_upload fltlft"/>');else $("#aux-file"+a).replaceWith('<input type="file" size="50" id="aux-file'+a+'" name="aux-file'+a+'" class="c_'+MsgingMod.sDepId+' file_upload fltlft"/>')}function resetTextArea(a){$("#msg_compose_body").replaceWith($("#msg_compose_body_tmplt_"+a).clone().attr("id","msg_compose_body").removeClass("displaynone"))}function composeMsg(a,b,c,d,e,f){"notes"==MsgingMod.sCrrntContentType?$("#msg_compose_body").val(""):"undefined"!=typeof f?resetTextArea(f):$("#msg_compose_body").val(""),MsgingMod.sCrrntCmpsMsgTmplt=f,b&&"undefined"!=typeof b?$("#msg_compose_parent_msg_id").val(b):$("#msg_compose_parent_msg_id").val(""),$("#msg_compose_subject").val("");var g=MsgingMod.bEmMapOnly?"Entry":"Structure",h=MsgingMod.bEmMapOnly?"Processed files":"Validation report and processed files",i=MsgingMod.bEmEntry?MsgingMod.sAccessionIdStringEmRel:MsgingMod.sAccessionIdString;a&&"undefined"!=typeof a?$("#msg_compose_subject").val(a):"undefined"!=typeof f&&"vldtn"==f?$("#msg_compose_subject").val(MsgingMod.sAccessionIdString+" - "+h+" are ready for your review"):"undefined"!=typeof f&&"approval-expl"==f?$("#msg_compose_subject").val("Acknowledgement of "+g+" Approval"):"undefined"!=typeof f&&"approval-impl"==f?$("#msg_compose_subject").val("Implicit Approval of Your "+g):"undefined"!=typeof f&&["release-publ","release-nopubl"].indexOf(f)>-1?$("#msg_compose_subject").val("Release of "+i):"undefined"!=typeof f&&"reminder"==f?$("#msg_compose_subject").val("Still awaiting feedback for "+MsgingMod.sAccessionIdString):"undefined"!=typeof f&&"system-unlocked"==f?$("#msg_compose_subject").val("System Unlocked"):"undefined"!=typeof f&&"withdrawn"==f?$("#msg_compose_subject").val("PDB ID "+MsgingMod.sPdbId+" has been withdrawn"):"undefined"!=typeof f&&"maponly-authstatus-em"==f?$("#msg_compose_subject").val("Annotation of your "+MsgingMod.sAccessionIdString):"notes"!=MsgingMod.sCrrntContentType&&$("#msg_compose_subject").val("Communication regarding "+MsgingMod.sAccessionIdString),c&&"undefined"!=typeof c?($("#msg_compose_parent_msg_div").removeClass("hidden"),$("#msg_compose_parent_msg").html('<p><span class="strong">SENDER:</span> '+d+'</p><p><span class="strong">DATE/TIME:</span> '+e+"</p><p>"+c+"</p>")):($("#msg_compose_parent_msg").html(""),$("#msg_compose_parent_msg_div").addClass("hidden")),"notes"==MsgingMod.sCrrntContentType?($("#msg_compose_assoc_files").addClass("hidden"),$("#msg_compose_attch_aux_file").addClass("hidden")):($("#msg_compose_assoc_files").removeClass("hidden"),$("#msg_compose_attch_aux_file").removeClass("hidden")),$("#msg_compose_subject").focus(),$("#msg_compose_body").scrollTop(0),clearFileUpload("all"),$("#aux-file-span2").addClass("hidden"),$("#aux-file-span3").addClass("hidden"),$("#msg_compose").on("shown.bs.modal",function(a){"undefined"!=typeof f&&["vldtn","release-publ","release-nopubl"].indexOf(f)>-1?$("#msg_compose_assoc_files").find("input[type=checkbox]:visible").prop("checked",!0):"undefined"!=typeof f&&["withdrawn"].indexOf(f)>-1?$("#checkbox_model").find("input[type=checkbox]:visible").prop("checked",!0):$("#msg_compose_assoc_files input:checkbox").prop("checked",!1),MsgingMod.iCmpsTotalFilesAvail=$("#msg_compose_assoc_files").find(".checkbox-inline input[type=checkbox]:visible").length}),"msgs"==MsgingMod.sCrrntContentType?confirmAvailFiles(function(){for(var a=0;a<MsgingMod.arrAvailFiles.length;a++)MsgingMod.bEmEntry&&MsgingMod.bEmMapOnly&&("model"===MsgingMod.arrAvailFiles[a]||"model_pdb"===MsgingMod.arrAvailFiles[a])||$("#checkbox_"+MsgingMod.arrAvailFiles[a]).removeClass("hidden");$("#msg_compose").modal("show")}):$("#msg_compose").modal("show")}function displayDraftMsg(a){MsgingMod.bNewDraftContext=!1;var b=new Message;b.loadFromDTrow(a);var c=b.message_text.replace(/<br \/>/g,"\n");if($("#msg_compose_msg_id").val(b.message_id),b.parent_message_id!=b.message_id){var d={context:"compose",msg_subject:b.message_subject,msg_text:c,callback:composeMsg};getMsgDict(b.parent_message_id,d)}else composeMsg(b.message_subject,void 0,void 0,void 0,void 0,void 0);markMsgAsRead(b.message_id),$("#msg_compose_body").val(c)}function getFileReferences(a){var b=[],c=[];for(var d in MsgingMod.oFilesRfrncd)if(d==a){b=MsgingMod.oFilesRfrncd[d];break}if(b.length>0)for(var e=0;e<b.length;e++){var f=b[e],g=f.relative_file_url.split("/"),h=g[g.length-1];f.file_name=h,c.push(f)}return c}function previewMsg(a){var b=new Message;if(b.loadFromDTrow(a),b.parent_message_id!=b.message_id){var c={context:"display",display_type:"preview_pane"};getMsgDict(b.parent_message_id,c)}else $("#preview_parent_msg").html(""),$("#preview_parent_msg_div").hide();"drafts"==MsgingMod.sViewContext?($(".preview_msg_action_btn").hide(),$(".draft_view").show()):"commhstry"!=MsgingMod.sCrrntContentType?("notes"==MsgingMod.sCrrntContentType?$(".preview_msg_action_btn.archive").show():$(".preview_msg_action_btn").show(),$(".draft_view").hide()):$(".preview_msg_action_btn").hide();var d=getFileReferences(b.message_id);if(d.length>0){$("#files_rfrncd_div").show();for(var e="",f=0;f<d.length;f++){var g=d[f],h=g.upload_file_name.length>1?" ("+g.upload_file_name+")":"";e+='<p><span class=""><a href="'+g.relative_file_url+'" target="_blank">'+g.file_name+h+"</a></span></p>"}$("#files_rfrncd").html(e)}else $("#files_rfrncd").html(""),$("#files_rfrncd_div").hide();$("#preview_msg_dep_id").html(MsgingMod.sCrrntDataSetID),$("#preview_msg_id").val(b.message_id),$("#preview_msg_ordinal_id").html(b.ordinal_id),$("#preview_msg_subject").html(b.message_subject),$("#preview_msg_sender").html(b.sender),$("#preview_msg_timestamp").html(b.timestamp),$("#preview_msg_body").html(b.message_text),$("#preview_msg").css({overflow:"auto",height:"99%"}),$("#resize_container").resizable({handles:"s",minHeight:150}),$("#preview_msg").scrollTop(0),MsgingMod.iDTscrollTopSaved=$("#rslts #"+MsgingMod.sDepId+"_tbl_wrapper .dataTables_scroll .dataTables_scrollBody").scrollTop(),MsgingMod.bCorrspndncHstryStndaln||(markMsgAsRead(b.message_id),redrawTable()),$("#resize_container").css("height",$("#preview_msg_body").height()+70)}function displayMsg(a,b){var c=new Message;if(c.loadFromDTrow(a),c.parent_message_id!=c.message_id){var d={context:"display",display_type:"dialog"};getMsgDict(c.parent_message_id,d)}else $("#parent_msg").html(""),$("#parent_msg_div").hide();var e=getFileReferences(c.message_id);if(e.length>0){$("#files_rfrncd_div_dialog").show();for(var f="",g=0;g<e.length;g++){var h=e[g],i=h.upload_file_name.length>1?" ("+h.upload_file_name+")":"";f+='<p><span class=""><a href="'+h.relative_file_url+'" target="_blank">'+h.file_name+i+"</a></span></p>"}$("#files_rfrncd_dialog").html(f)}else $("#files_rfrncd_dialog").html(""),$("#files_rfrncd_div_dialog").hide();if($("#msg_dep_id").html(MsgingMod.sCrrntDataSetID),$("#msg_id").val(c.message_id),$("#msg_ordinal_id").html(c.ordinal_id),$("#msg_subject").html(c.message_subject),$("#msg_sender").html(c.sender),$("#msg_timestamp").html(c.timestamp),$("#msg_body").html(c.message_text),MsgingMod.bCorrspndncHstryStndaln||markMsgAsRead(c.message_id),b){var j=screen.width-100,k=screen.height-200;window.open(MsgingMod.URL.DISPLAY_MSG+"?annotator="+MsgingMod.sAnnotator+"&msg_id="+c.message_id+"&sessionid="+MsgingMod.sSessionId+"&identifier="+MsgingMod.sCrrntDataSetID+"&filesource="+MsgingMod.sFileSource+"&content_type="+MsgingMod.sCrrntContentType,"dsplyMsgWndw"+c.message_id,"width="+j+", height="+k+", top=50, left=50, menubar=no, status=no, toolbar=no, titlebar=no, location=no, scrollbars=yes")}else $("#msg_body_display").modal("show")}function getMsgDict(a,b){var c=new Message;return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.GET_MSG,async:!0,clearForm:!1,dataType:"json",beforeSubmit:function(b,c,d){b.push({name:"msg_id",value:a})},success:function(a){if(a.msg_dict&&(c.loadFromJson(a.msg_dict),"undefined"!=typeof b.context))if("compose"===b.context){var d="undefined"!=typeof b.msg_prefix?b.msg_prefix+c.message_subject:"undefined"!=typeof b.msg_subject?b.msg_subject:"[SUBJECT PLACHEHOLDER]",e="undefined"!=typeof b.msg_text?b.msg_text:"";b.callback(d,c.message_id,c.message_text,c.sender,c.timestamp,void 0),$("#msg_compose_body").val(e);
}else if("propagate"===b.context){var f="undefined"!=typeof b.propagate_type?b.propagate_type:"error";b.callback(c.message_subject,c.message_id,c.message_text,c.sender,c.timestamp,f)}else"display"===b.context&&"undefined"!=typeof b.display_type&&c.message_text&&"undefined"!=typeof c.message_text&&("preview_pane"===b.display_type?($("#preview_parent_msg_div").show(),$("#preview_parent_msg").html('<p><span class="strong">SENDER:</span> '+c.sender+'</p><p><span class="strong">DATE/TIME:</span> '+c.timestamp+"</p><p>"+c.message_text+"</p>")):"dialog"===b.display_type&&($("#parent_msg_div").show(),$("#parent_msg").html('<p><span class="strong">SENDER:</span> '+c.sender+'</p><p><span class="strong">DATE/TIME:</span> '+c.timestamp+"</p><p>"+c.message_text+"</p>")))}}),!1}function markMsgAsRead(a){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.MARK_MSG_READ,async:!0,clearForm:!1,beforeSubmit:function(b,c,d){b.push({name:"msg_id",value:a})},success:function(){MsgingMod.arrMsgsAlreadyRead.push(a),checkGlobalMsgStatus()}}),!1}function tagMsg(a,b,c){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.TAG_MSG,async:!0,clearForm:!1,beforeSubmit:function(d,e,f){d.push({name:"msg_id",value:MsgingMod.sCrrntMsgIdSlctd}),d.push({name:"action_reqd",value:a}),d.push({name:"read_status",value:b}),d.push({name:"for_release",value:c})},success:function(){var d=MsgingMod.arrMsgsForRelease.indexOf(MsgingMod.sCrrntMsgIdSlctd),e=MsgingMod.arrMsgsAlreadyRead.indexOf(MsgingMod.sCrrntMsgIdSlctd),f=MsgingMod.arrMsgsNoActionReqd.indexOf(MsgingMod.sCrrntMsgIdSlctd);"N"==a?0>f&&MsgingMod.arrMsgsNoActionReqd.push(MsgingMod.sCrrntMsgIdSlctd):f>-1&&MsgingMod.arrMsgsNoActionReqd.splice(f,1),"Y"==c?0>d&&MsgingMod.arrMsgsForRelease.push(MsgingMod.sCrrntMsgIdSlctd):d>-1&&MsgingMod.arrMsgsForRelease.splice(d,1),"N"==b&&e>-1&&MsgingMod.arrMsgsAlreadyRead.splice(e,1),checkGlobalMsgStatus()}}),!1}function progressStart(){$("#loading").fadeIn("slow").spin("large","black")}function progressEnd(){$("#loading").fadeOut("fast").spin(!1)}function submitNewMsg(a){var b;b="sentmsgs"==MsgingMod.sViewContext||1==MsgingMod.bNewDraftContext?MsgingMod.URL.SUBMIT_MSG:MsgingMod.URL.UPDATE_DRAFT_STATE;var c=document.location.hostname;$("#msg_compose_frm").ajaxSubmit({url:b,async:!0,clearForm:!1,beforeSubmit:function(b,d,e){b.push({name:"send_status",value:a}),b.push({name:"filesource",value:MsgingMod.sFileSource}),b.push({name:"content_type",value:MsgingMod.sCrrntContentType}),b.push({name:"hostname",value:c}),b.push({name:"msgs_high_watermark",value:MsgingMod.iCrrntMsgsHwm}),b.push({name:"notes_high_watermark",value:MsgingMod.iCrrntNotesHwm})},success:function(b){if("true"==b.success){getFilesReferenced(),"Y"==a&&checkGlobalMsgStatus(),progressEnd(),"sentmsgs"==MsgingMod.sViewContext?reLoadMsgs():loadDrafts();try{"true"==String(b.pdbx_model_updated)?dodepuiresetmessage(document,MsgingMod.sDepId,b.depid_pw):"false"==String(b.pdbx_model_updated)}catch(c){alert("Problem when application made request to have DEP UI reset.")}}else{var d="There was a problem submitting the message.",e="";b.append_msg.length>1&&(e=String(b.append_msg)),e.length>1&&(d=d+" "+e),alert(d)}}})}function propagateMsg(a,b,c,d,e,f){var g="archive"==f?MsgingMod.URL.ARCHIVE_MSG:MsgingMod.URL.FORWARD_MSG,h="archive"==f?$("#archive_msg_target_depid").val():$("#forward_msg_target_depid").val(),i=document.location.hostname,j="",k=getFileReferences(b);if(k.length>0)for(var l="",m=0;m<k.length;m++){var n=k[m],o=n.upload_file_name.length>1?" ("+n.upload_file_name+")":"";m>0&&(l=", "),j+=l+n.file_name+o}var p="ORIG MESSAGE SENDER: "+d+"\nORIG MESSAGE DATETIME: "+e+"\n\nORIG MESSAGE BODY:\n\n"+c+"\n\nORIG FILE REFERENCES: "+j;$("#hlprfrm").ajaxSubmit({url:g,async:!0,clearForm:!1,type:"POST",beforeSubmit:function(b,c,f){b.push({name:"send_status",value:"Y"}),b.push({name:"filesource",value:MsgingMod.sFileSource}),b.push({name:"content_type",value:MsgingMod.sCrrntContentType}),b.push({name:"hostname",value:i}),b.push({name:"subject",value:a}),b.push({name:"message",value:p}),b.push({name:"mode",value:"manual"}),b.push({name:"target_identifier",value:h}),b.push({name:"orig_sender",value:d}),b.push({name:"orig_recipient",value:"MessagingModule"}),b.push({name:"orig_date",value:e}),b.push({name:"orig_subject",value:a}),b.push({name:"orig_attachments",value:j})},success:function(a){var b=!1;if(a.success)for(var c in a.success)"job"==c?"error"==a.success[c]&&(alert("An application error has occurred while executing this request."),b=!0):"false"==a.success[c]&&(alert("Problem on attempt to "+f+" message for dep ID: "+c+". Please verify that this is a valid dep ID."),b=!0)}})}function convertColNameToIntIndex(a){var b=-1;for(x=0;x<MsgingMod.arrOrderedColumnList.length;x++)a==MsgingMod.arrOrderedColumnList[x]&&(b=x);return b}function getTrueColIdx(a){return 0==MsgingMod.iCnt_DrawBackCalledOnCurrentTbl?iTrueColIdx=a:iTrueColIdx=MsgingMod.arrColDisplOrderCorrHx[a],iTrueColIdx}function applySearchHeaderFunctions(a){var b="#"+MsgingMod.sCrrntDataSetID+"_tbl_wrapper div.dataTables_scrollHead thead input";$(b).keyup(function(){a.fnFilter(this.value,getTrueColIdx($(b).index(this)))})}function loadTestExampleSeeJson(a){return $("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.SEE_RAW_JSON_FOR_DTBL,async:!0,clearForm:!1,target:"#rslts",beforeSubmit:function(b,c,d){b.push({name:"identifier",value:a})},success:function(){}}),!1}var MsgingMod={sSessionId:SESSION_ID,sDepId:DEPID,sDisplayId:DISPLAYID,sPdbId:"[PDBID]",sAccessionIdString:"[ACCESSION_ID_STRING]",sAccessionIdStringEmRel:"[ACCESSION_ID_STRING_EM_REL]",sSessionPathPrefix:SESS_PATH_PREFIX,sFileSource:FILE_SOURCE,sDefaultMsgType:"vldtn",bEmbeddedView:EMBEDDED_VW,bEmEntry:EM_ENTRY,bEmMapOnly:EM_MAP_ONLY,bEmMapAndModel:EM_MAP_AND_MODEL,iAjaxTimeout:6e4,sAdminContact:'Send comments to: <a href="mailto:rsala@rcsb.rutgers.edu">help@wwpdb-dev.rutgers.edu</a>',sInfoStyle:'<span class="ui-icon ui-icon-info fltlft"></span> ',sErrStyle:'<span class="ui-icon ui-icon-alert fltlft"></span> ',bDebug:!0,oDataTable:void 0,oFilesRfrncd:{},iCnt_DrawBackCalledOnCurrentTbl:0,bResetDisplay:!0,iCrrntMsgsHwm:null,iCrrntNotesHwm:null,sCrrntRowSlctd:"",sCrrntMsgIdSlctd:"",sCrrntDataSetID:"D_000000",sCrrntContentType:"msgs",sUseServerSidePrcssing:"true",sUseThreaded:"false",sNotesFlagActive:"true",sNotesFlagActiveBmrb:"true",bAllowSorting:!1,sViewContext:"sentmsgs",bNewDraftContext:!1,iMsgCmpsHtMin:775,iMsgCmpsHtWthParentContent:875,iMsgDisplWdthMin:1200,iMsgDisplHtMin:800,iMsgDisplHtWthParentContent:850,iNoteCmpsHt:600,sCrrntCmpsMsgTmplt:"",iCmpsTotalFilesAvail:0,arrAvailFiles:[],arrMsgsAlreadyRead:[],arrMsgsForRelease:[],arrMsgsNoActionReqd:[],arrOrderedColumnList:[],arrColDisplOrderCorrHx:[],bNotesExist:!1,bTurnOffDTmDataConversion:!1,bMsgPanelShown:!1,iDTscrollTopSaved:0,iRsltsResizeContainerInitHt_Msgs:275,iBottomDTpaddingHt_Msgs:100,iScrollY_Msgs:175,iRsltsResizeContainerInitHt_CommHstry:385,iBottomDTpaddingHt_CommHstry:220,iScrollY_CommHstry:175,iRsltsResizeContainerHtPrePrint_CommHstry:385,bCorrspndncHstryStndaln:!1,URL:{WFLAUNCH:"/service/messaging/new_session/wf",DEVLAUNCH:"/service/messaging/launch",SEE_RAW_JSON_FOR_DTBL:"/service/messaging/test_see_json",DTBL_GET_TMPLT:"/service/messaging/get_dtbl_config_dtls",DTBL_AJAX_LOAD:"/service/messaging/get_dtbl_data",DTBL_DELETE_ROW:"/service/messaging/delete_row",SUBMIT_MSG:"/service/messaging/submit_msg",ARCHIVE_MSG:"/service/messaging/archive_msg",FORWARD_MSG:"/service/messaging/forward_msg",UPDATE_DRAFT_STATE:"/service/messaging/update_draft_state",MARK_MSG_READ:"/service/messaging/mark_msg_read",TAG_MSG:"/service/messaging/tag_msg",EXIT_NOT_FINISHED:"/service/messaging/exit_not_finished",EXIT_FINISHED:"/service/messaging/exit_finished",GET_MSG:"/service/messaging/get_msg",CHECK_AVAIL_FILES:"/service/messaging/check_avail_files",GET_FILES_RFRNCD:"/service/messaging/get_files_rfrncd",CHECK_GLBL_MSG_STATUS:"/service/messaging/check_global_msg_status",DISPLAY_MSG:"/service/messaging/display_msg",TOGGLE_NOTES_FLAGGING:"/service/messaging/toggle_notes_flagging",GET_DEPUI_PWD:"/service/messaging/get_depui_pwd",GET_MSG_TMPLTS:"/service/messaging/get_msg_tmplts",VERIFY_DEPID:"/service/messaging/verify_depid"},LABEL:{MSG_THREAD_VIEW:"Switch to Message Thread View",STD_SORT_VIEW:"Switch to Standard Sorting View",TURN_OFF_NOTES_FLAG:"Disable Notes Flag in WFM UI",TURN_ON_NOTES_FLAG:"Enable Notes Flag in WFM UI",TURN_OFF_NOTES_FLAG_BMRB:"Disable BMRB Notes Flag in WFM UI",TURN_ON_NOTES_FLAG_BMRB:"Enable BMRB Notes Flag in WFM UI",SHOW_MSG_PNL:"Show Message View Panel",HIDE_MSG_PNL:"Hide Message View Panel"},STYLE:{COLOR_NOTES:"purple",COLOR_MSGS:"black",COLOR_COMMHSTRY:"blue"}};Array.prototype.indexOf||(Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),String.prototype.startsWith=function(a){return this.match("^"+a)==a},$(document).ready(function(){function a(){$("#msg_compose").modal("hide"),progressStart(),submitNewMsg("Y")}function b(a,b){$(a).hasClass("msg_read")?("msgs"==MsgingMod.sCrrntContentType&&$("#tag_msg_choice").removeClass("ui-state-disabled"),$("#archv_msg").removeClass("ui-state-disabled")):($("#tag_msg_choice").addClass("ui-state-disabled"),$("#archv_msg").addClass("ui-state-disabled")),$("#context_menu").show(),$("#context_menu").position({my:"left-2 top-2",of:b}),$(document).on("click",function(a){$(a.target).closest("#context_menu").length||$("#context_menu").hide()})}$(document).ajaxError(function(a,b,c,d){try{0==b.status?$(".errmsg.glblerr").html(MsgingMod.sErrStyle+"You are offline!!<br />Please Check Your Network.").show().fadeOut(4e3):404==b.status?$(".errmsg.glblerr").html(MsgingMod.sErrStyle+'Requested URL "'+c.url+'" not found.<br />').show().fadeOut(4e3):500==b.status?$(".errmsg.glblerr").html(MsgingMod.sErrStyle+"Internel Server Error.<br />").show().fadeOut(4e3):"parsererror"==a?$(".errmsg.glblerr").html(MsgingMod.sErrStyle+"Error.\nParsing JSON Request failed.<br />").show().fadeOut(4e3):"timeout"==a?$(".errmsg.glblerr").html(MsgingMod.sErrStyle+"Request Time out.<br />").show().fadeOut(4e3):$(".errmsg.glblerr").html(MsgingMod.sErrStyle+b.status+" : "+d+"<br />\n").show().fadeOut(4e3)}catch(e){$(".loading").hide();var f="There was an error while processing your request.\n";f+="Error description: "+e.description+"\n",f+="Click OK to continue.\n",alert(f)}}),$("#context_menu").menu(),$("#context_menu_content").show(),$('[data-toggle="tooltip"]').tooltip(),MsgingMod.sCrrntContentType=CONTENT_TYPE,$("#forward_msg").dialog({autoOpen:!1,height:400,width:400,modal:!0,buttons:{Forward:function(){var a=MsgingMod.sCrrntMsgIdSlctd,b={context:"propagate",propagate_type:"forward",callback:propagateMsg};getMsgDict(a,b)},Cancel:function(){$("#forward_msg").dialog("close")}},close:function(){}}),"undefined"==typeof CORRSPNDNC_HSTRY_STNDALN||null===CORRSPNDNC_HSTRY_STNDALN||CORRSPNDNC_HSTRY_STNDALN===!1?(getMsgTemplates(),autoLoadMsgs(),confirmAvailFiles(),getFilesReferenced(),checkGlobalMsgStatus()):CORRSPNDNC_HSTRY_STNDALN===!0&&(MsgingMod.bCorrspndncHstryStndaln=!0,loadCommHstry()),$("#threaded_view_toggle").bt({contentSelector:"$('#threaded_view_toggle_help').html()",positions:["right","top"],trigger:"hoverIntent",width:"350px",hoverIntentOpts:{interval:850}}),$("#notes_flag_toggle").bt({contentSelector:"$('#notes_flag_toggle_help').html()",positions:["right","top"],trigger:"hoverIntent",width:"350px",hoverIntentOpts:{interval:850}}),$("#notes_flag_bmrb_toggle").bt({contentSelector:"$('#notes_flag_bmrb_toggle_help').html()",positions:["right","top"],trigger:"hoverIntent",width:"350px",hoverIntentOpts:{interval:850}}),$(".tag_msg").on("click",function(){var a=$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+MsgingMod.sCrrntRowSlctd)[0];promptForMsgTags(a,"msgbody_visible")}),$("#archive_msg_ok").on("click",function(){var a=MsgingMod.sCrrntMsgIdSlctd,b={context:"propagate",propagate_type:"archive",callback:propagateMsg};getMsgDict(a,b)}),$("#tag_msg_ok").on("click",function(){var a="Y",b="Y",c="N";$("#tag_msg :checkbox:checked").each(function(){value=$(this).val(),"no_action_reqd"==value&&(a="N"),"unread"==value&&(b="N"),"for_release"==value&&(c="Y")}),tagMsg(a,b,c),"msgs"==MsgingMod.sCrrntContentType&&(MsgingMod.iDTscrollTopSaved=$("#rslts #"+MsgingMod.sDepId+"_tbl_wrapper .dataTables_scroll .dataTables_scrollBody").scrollTop(),redrawTable())}),$("#tag_msg_cancel").on("click",function(){$("#context_menu").hide()}),$("#unlock_depui").on("click",function(){var a=confirm("Click on OK to confirm that you do wish to reset and unlock the Dep UI for this entry.");1==a&&(progressStart(),setTimeout(function(){$("#hlprfrm").ajaxSubmit({url:MsgingMod.URL.GET_DEPUI_PWD,async:!0,clearForm:!1,success:function(a){if(a)try{a.depui_pwd.length>0?(dodepuiresetmessage(document,MsgingMod.sDepId,a.depui_pwd),dodepuistatusmessage(document,MsgingMod.sDepId,a.depui_pwd,"unlock"),progressEnd(),MsgingMod.sViewContext="sentmsgs",MsgingMod.sCrrntContentType="msgs",reLoadMsgs(),composeMsg(void 0,void 0,void 0,void 0,void 0,"system-unlocked")):alert("Problem obtaining access to Dep UI")}catch(b){alert("Problem when application made request to have DEP UI reset.")}}}),progressEnd()},1100))}),$(".modal-wide").on("show.bs.modal",function(){var a=$(window).height()-100;$(this).find(".modal-body").css("max-height",a)}),$("#msg_compose").on("shown.bs.modal",function(a){$("#msg_compose_body").width($("#msg_compose_frm").width()-25),$("#msg_compose .modal-body").scrollTop(0)}),$(".send").on("click",function(b){var c=$("#msg_compose_subject").val();if(c.length>1)if("vldtn"==MsgingMod.sCrrntCmpsMsgTmplt||c.indexOf("Validation report")>=0||c.indexOf("are ready for your review")>=0){var d=$("#msg_compose_assoc_files").find(".checkbox-inline input[type=checkbox]:checked").length;if(d<MsgingMod.iCmpsTotalFilesAvail){var e=confirm("WARNING: Only "+d+" file(s) selected for attachment. Click 'Cancel' if you wish to abort. Click 'OK' if you wish to send.");1==e&&a()}else a()}else a();else alert("Please supply a message 'Subject'.")}),$(".reply").on("click",function(){var a=$(this).attr("id").split("_")[1],b="";"preview"==a&&(b="preview_");var c=$("#"+b+"msg_id").val(),d={context:"compose",msg_prefix:"RE: ",callback:composeMsg};getMsgDict(c,d)}),$(".save_draft").on("click",function(){submitNewMsg("N")}),$(".archive").on("click",function(){$("#archive_msg_target_depid").val(MsgingMod.sDepId),$("#archive_msg").modal("show")}),$("#collapse_msg_preview").on("show.bs.collapse",function(){MsgingMod.bMsgPanelShown=!0;var a=$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+MsgingMod.sCrrntRowSlctd)[0];"undefined"==typeof a&&(a=$("#rslts #"+MsgingMod.sDepId+"_tbl.dataTable tbody tr.dt_row:first")[0]),"undefined"!=typeof a?($("#btn_collapse_msg_preview").text(MsgingMod.LABEL.HIDE_MSG_PNL),markRowAsSelected(a,!1),previewMsg(a)):$("#collapse_msg_preview").collapse("hide")}),$("#collapse_msg_preview").on("shown.bs.collapse",function(){$("#resize_container").css("height",$("#preview_msg_body").height()+70)}),$("#collapse_msg_preview").on("hide.bs.collapse",function(){$("#btn_collapse_msg_preview").text(MsgingMod.LABEL.SHOW_MSG_PNL),MsgingMod.bMsgPanelShown=!1}),$(".get_content_type").click(function(){var a=$(this).attr("id");$(".navbar li").removeClass("active");var b=$(this).attr("name");$("#hlprfrm_content_type").val(b),CONTENT_TYPE=b,MsgingMod.sCrrntContentType=CONTENT_TYPE,$("#hlprfrm_auto_launch_compose").val("false"),"commhstry"==b?loadCommHstry():"get_draft_msgs"==a||"get_draft_notes"==a?loadDrafts():(MsgingMod.sViewContext="sentmsgs",reLoadMsgs())}),$(".test_getmsgs_see_json").click(function(){var a=$(this).attr("name");MsgingMod.sCrrntDataSetID=a,loadTestExampleSeeJson(a)}),$("#threaded_view_toggle").click(function(){var a=$(this).text(),b=(MsgingMod.sDepId,a==MsgingMod.LABEL.MSG_THREAD_VIEW?MsgingMod.LABEL.STD_SORT_VIEW:MsgingMod.LABEL.MSG_THREAD_VIEW);$(this).text(b),MsgingMod.sUseThreaded=a==MsgingMod.LABEL.MSG_THREAD_VIEW?"true":"false",MsgingMod.bAllowSorting=a!=MsgingMod.LABEL.MSG_THREAD_VIEW,MsgingMod.iCnt_DrawBackCalledOnCurrentTbl=0,loadMsgsDT("Y")}),$("#notes_flag_toggle").click(function(){var a=$(this).text(),b=(MsgingMod.sCrrntDataSetID,a==MsgingMod.LABEL.TURN_OFF_NOTES_FLAG?MsgingMod.LABEL.TURN_ON_NOTES_FLAG:MsgingMod.LABEL.TURN_OFF_NOTES_FLAG);$(this).text(b),MsgingMod.sNotesFlagActive=a==MsgingMod.LABEL.TURN_OFF_NOTES_FLAG?"false":"true",toggleNotesFlagging()}),$("#notes_flag_bmrb_toggle").click(function(){var a=$(this).text(),b=(MsgingMod.sCrrntDataSetID,a==MsgingMod.LABEL.TURN_OFF_NOTES_FLAG_BMRB?MsgingMod.LABEL.TURN_ON_NOTES_FLAG_BMRB:MsgingMod.LABEL.TURN_OFF_NOTES_FLAG_BMRB);$(this).text(b),MsgingMod.sNotesFlagActiveBmrb=a==MsgingMod.LABEL.TURN_OFF_NOTES_FLAG_BMRB?"false":"true",toggleNotesFlagging("bmrb")}),$("#msging-navbar").on("click",".compose",function(){"drafts"==MsgingMod.sViewContext?MsgingMod.bNewDraftContext=!0:MsgingMod.bNewDraftContext=!1;var a=$(this).attr("id").split("_")[1];composeMsg(void 0,void 0,void 0,void 0,void 0,a)}),$(".edit").click(function(){var a=$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+MsgingMod.sCrrntRowSlctd)[0];displayDraftMsg(a)}),$("#rslts").on("click","tbody tr",function(a){var c=this;return a.ctrlKey||a.metaKey?("commhstry"!=MsgingMod.sCrrntContentType&&"drafts"!=MsgingMod.sViewContext&&(markRowAsSelected(c,!0),b(c,a)),!1):(markRowAsSelected(c,!1),void(MsgingMod.bMsgPanelShown&&previewMsg(c)))}),$("#rslts").on("contextmenu","tbody tr",function(a){if("commhstry"!=MsgingMod.sCrrntContentType&&"drafts"!=MsgingMod.sViewContext){var c=this;markRowAsSelected(c,!0),b(c,a)}return!1}),$(".msg_context_menu_choice").click(function(){var a=$(this).attr("id"),b=$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+MsgingMod.sCrrntRowSlctd)[0];if("tag_msg_choice"==a)$(b).hasClass("msg_read")&&promptForMsgTags(b,"msgbody_hidden");else if("archv_msg"==a)$(b).hasClass("msg_read")&&($("#archive_msg_target_depid").val(MsgingMod.sDepId),$("#archive_msg").modal("show"));else if("fwd_msg"==a)$("#forward_msg_target_depid").val(""),$("#forward_msg").dialog("open");else if("view_msg_nw_wndw"==a){displayMsg(b,!0);var c=$(b).attr("id");$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+c).addClass("msg_read")}$("#context_menu").hide()}),$("#rslts").on("dblclick","tbody tr",function(a){var b=$(this).attr("id");$("#rslts table.DTFC_Cloned #"+b).hasClass("row_selected")||$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+b).hasClass("row_selected")||($("#rslts tbody tr.row_selected").removeClass("row_selected"),$("#rslts table.DTFC_Cloned #"+b).addClass("row_selected"),$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+b).addClass("row_selected"),$("#"+MsgingMod.sCrrntDataSetID+"_delete_row").show(),$(".help.unselect").show(),$(".help.select_to_delete").hide(),MsgingMod.sCrrntRowSlctd=b),MsgingMod.bCorrspndncHstryStndaln||($("#rslts table.DTFC_Cloned #"+b).addClass("msg_read"),$("#rslts #"+MsgingMod.sCrrntDataSetID+"_tbl #"+b).addClass("msg_read")),"drafts"!=MsgingMod.sViewContext?displayMsg(this,!1):displayDraftMsg(this)}),$(".clearfile").on("click",function(a){var b=$(this).attr("id").split("clear")[1];clearFileUpload(b)}),$(".addanother").on("click",function(a){var b=$(this).attr("id").split("addanother")[1];$("#aux-file-span"+(parseInt(b)+1)).removeClass("hidden")}),$("#other-value-form").find("input").keypress(function(a){return a.which&&13==a.which||a.keyCode&&13==a.keyCode?($(this).parent().parent().parent().parent().find(".ui-dialog-buttonpane").find("button:first").click(),!1):void 0}),$("#select_all_file_references").on("click",function(){$("#msg_compose_assoc_files").find("input[type=checkbox]:visible").prop("checked",this.checked)}),$(".assoc_files_chckbox input[type=checkbox]").on("click",function(){var a=this.checked;a||$("#select_all_file_references").prop("checked",this.checked)}),$("#msglist_panel").on("click",".DTTT_button_print",function(){$("#rslts_resize_container").height($("#"+MsgingMod.sDepId+"_tbl").height()+10)}),$("#testcheckboxes").click(function(){var a="",b=0;$("#rslts :checkbox:checked").each(function(){b++,a+=(a.length>0?",":"")+$(this).parents("td").attr("true_row_idx")}),$("#rowids").val(a),b>0?alert("List of row IDs currently selected for cif category '"+MsgingMod.sCrrntDataSetID+"' is: "+a):alert("Currently no row(s) selected for cif category '"+MsgingMod.sCrrntDataSetID+"'")})});var calcDataTableHeight=function(){var a="commhstry"==MsgingMod.sCrrntContentType?MsgingMod.iBottomDTpaddingHt_CommHstry:MsgingMod.iBottomDTpaddingHt_Msgs,b=Math.floor($("#rslts_resize_container").height());return b-a+"px"};